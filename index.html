<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>MingleNow | Chat with Strangers Instantly ‚Äî Free Video & Text Chat</title>
<meta name="description" content="MingleNow ‚Äî Meet someone new in seconds. Free random video and text chat with interest matching. No sign-up required. Connect with people worldwide instantly.">
<meta name="keywords" content="chat with strangers, random video chat, omegle alternative, text chat, meet new people, free video chat, anonymous chat, online chat, talk to strangers, random chat, video call strangers, MingleNow">
<meta name="author" content="MingleNow">
<meta name="robots" content="index, follow">
<link rel="canonical" href="https://uminglenow.com">

<!-- Open Graph (Facebook, Discord, iMessage) -->
<meta property="og:type" content="website">
<meta property="og:url" content="https://uminglenow.com">
<meta property="og:title" content="MingleNow ‚Äî Chat with Strangers Instantly">
<meta property="og:description" content="Free random video & text chat with interest matching. Meet people from around the world. No sign-up needed.">
<meta property="og:site_name" content="MingleNow">
<meta property="og:locale" content="en_US">

<!-- Twitter Card -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="MingleNow ‚Äî Chat with Strangers Instantly">
<meta name="twitter:description" content="Free random video & text chat. Meet new people worldwide in seconds.">

<!-- Additional SEO -->
<meta name="theme-color" content="#6c5ce7">
<meta name="application-name" content="MingleNow">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="MingleNow">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<!-- Structured Data (JSON-LD) for Google -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebApplication",
  "name": "MingleNow",
  "url": "https://uminglenow.com",
  "description": "Free random video and text chat platform. Meet new people worldwide with interest matching. No sign-up required.",
  "applicationCategory": "SocialApplication",
  "operatingSystem": "Web",
  "offers": {
    "@type": "Offer",
    "price": "0",
    "priceCurrency": "USD"
  },
  "featureList": "Random Video Chat, Text Chat, Interest Matching, Virtual Gifts, Friends System"
}
</script>

<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üí¨</text></svg>">
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<script src="https://www.paypal.com/sdk/js?AcPcM3sB90xJ0O0XPfJWkEfLYUVhHa4lrl-Oknk82gEdF5_X7Xw5scK0bl-Msh6F-JCKSm-TZ0gjSkYW&currency=USD&disable-funding=credit,card" data-sdk-integration-source="button-factory"></script>
<script src="https://accounts.google.com/gsi/client" async defer></script>
<style>
  *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
  :root {
    --bg: #0a0a0f; --surface: #12121a; --surface-2: #1a1a26; --surface-3: #222233;
    --accent: #6c5ce7; --accent-glow: #a29bfe; --green: #00e676; --red: #e84393;
    --text: #eeeef0; --text-dim: #8888a0; --border: rgba(255,255,255,0.06);
    --radius: 16px;
  }
  html { scroll-behavior: smooth; }
  body {
    font-family: 'Outfit', sans-serif; background: var(--bg); color: var(--text);
    min-height: 100vh; overflow-x: hidden; -webkit-font-smoothing: antialiased;
  }

  /* ‚ïê‚ïê‚ïê BG ‚ïê‚ïê‚ïê */
  .bg-orbs { position: fixed; inset: 0; z-index: 0; pointer-events: none; overflow: hidden; }
  .bg-orbs .orb { position: absolute; border-radius: 50%; filter: blur(120px); opacity: 0.25; animation: orbFloat 20s ease-in-out infinite alternate; }
  .bg-orbs .orb:nth-child(1) { width: 600px; height: 600px; background: var(--accent); top: -200px; left: -100px; }
  .bg-orbs .orb:nth-child(2) { width: 500px; height: 500px; background: #e84393; bottom: -200px; right: -100px; animation-delay: -7s; }
  .bg-orbs .orb:nth-child(3) { width: 400px; height: 400px; background: #00b894; top: 50%; left: 50%; transform: translate(-50%,-50%); animation-delay: -14s; opacity: 0.12; }
  @keyframes orbFloat { 0%{transform:translate(0,0) scale(1)} 50%{transform:translate(60px,-40px) scale(1.1)} 100%{transform:translate(-20px,30px) scale(0.95)} }
  body::before { content:''; position:fixed; inset:0; z-index:1; pointer-events:none; background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.04'/%3E%3C/svg%3E"); opacity:0.5; }

  /* ‚ïê‚ïê‚ïê PAGES ‚ïê‚ïê‚ïê */
  .page { display: none; position: relative; z-index: 2; min-height: 100vh; }
  .page.active { display: block; }
  .page-chat { display: none; }
  .page-chat.active { display: flex; flex-direction: column; height: 100vh; height: 100dvh; }

  /* ‚ïê‚ïê‚ïê NAV ‚ïê‚ïê‚ïê */
  nav { display:flex; align-items:center; justify-content:space-between; padding:20px 40px; max-width:1200px; margin:0 auto; }
  .logo { font-weight:800; font-size:1.6rem; letter-spacing:-0.5px; display:flex; align-items:center; gap:8px; cursor:pointer; }
  .logo-icon { width:36px; height:36px; background:linear-gradient(135deg,var(--accent),#e84393); border-radius:10px; display:flex; align-items:center; justify-content:center; font-size:1.1rem; }
  .online-badge { display:flex; align-items:center; gap:8px; background:var(--surface); border:1px solid var(--border); padding:8px 16px; border-radius:100px; font-size:0.9rem; font-weight:600; }
  .online-dot { width:8px; height:8px; background:var(--green); border-radius:50%; animation:pulse 2s ease-in-out infinite; box-shadow:0 0 8px var(--green); }
  @keyframes pulse { 0%,100%{opacity:1;transform:scale(1)} 50%{opacity:0.6;transform:scale(0.85)} }

  /* ‚ïê‚ïê‚ïê HERO ‚ïê‚ïê‚ïê */
  .hero { max-width:1200px; margin:0 auto; padding:80px 40px 60px; text-align:center; }
  .hero h1 { font-size:clamp(2.8rem,7vw,5.5rem); font-weight:900; line-height:1.05; letter-spacing:-2px; margin-bottom:24px; background:linear-gradient(135deg,#fff 0%,#ccc 50%,var(--accent-glow) 100%); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text; }
  .hero p { font-size:1.2rem; color:var(--text-dim); max-width:560px; margin:0 auto 48px; line-height:1.6; font-weight:300; }

  /* ‚ïê‚ïê‚ïê MODE CARDS ‚ïê‚ïê‚ïê */
  .mode-cards { display:flex; gap:20px; justify-content:center; flex-wrap:wrap; margin-bottom:40px; }
  .mode-card { background:var(--surface); border:1px solid var(--border); border-radius:var(--radius); padding:40px 50px; cursor:pointer; transition:all 0.3s cubic-bezier(0.4,0,0.2,1); position:relative; overflow:hidden; text-decoration:none; color:var(--text); min-width:220px; }
  .mode-card::before { content:''; position:absolute; inset:0; background:linear-gradient(135deg,var(--accent),#e84393); opacity:0; transition:opacity 0.3s; }
  .mode-card:hover { transform:translateY(-4px); border-color:var(--accent); box-shadow:0 20px 60px rgba(108,92,231,0.15); }
  .mode-card:hover::before { opacity:0.08; }
  .mode-card-icon { font-size:2.4rem; margin-bottom:12px; position:relative; z-index:1; }
  .mode-card-title { font-size:1.3rem; font-weight:700; position:relative; z-index:1; margin-bottom:4px; }
  .mode-card-sub { font-size:0.85rem; color:var(--text-dim); position:relative; z-index:1; }
  .or-divider { display:flex; align-items:center; font-size:0.85rem; color:var(--text-dim); font-weight:500; letter-spacing:2px; text-transform:uppercase; }

  /* ‚ïê‚ïê‚ïê INTERESTS ‚ïê‚ïê‚ïê */
  .interests-section { max-width:560px; margin:0 auto 20px; }
  .interests-label { font-size:0.9rem; color:var(--text-dim); margin-bottom:12px; }
  .interests-input-wrap { display:flex; align-items:center; gap:8px; background:var(--surface); border:1px solid var(--border); border-radius:12px; padding:12px 16px; transition:border-color 0.3s; flex-wrap:wrap; }
  .interests-input-wrap:focus-within { border-color:var(--accent); }
  .interests-input-wrap input { flex:1; background:none; border:none; color:var(--text); font-family:'Outfit',sans-serif; font-size:0.95rem; outline:none; min-width:120px; }
  .interests-input-wrap input::placeholder { color:var(--text-dim); }
  .tag { background:rgba(108,92,231,0.15); color:var(--accent-glow); padding:4px 12px; border-radius:100px; font-size:0.8rem; font-weight:500; display:flex; align-items:center; gap:6px; white-space:nowrap; animation:tagIn 0.2s ease; }
  @keyframes tagIn { from{transform:scale(0.8);opacity:0} to{transform:scale(1);opacity:1} }
  .tag-remove { cursor:pointer; opacity:0.6; transition:opacity 0.2s; font-size:1rem; line-height:1; }
  .tag-remove:hover { opacity:1; }
  .moderation-note { font-size:0.8rem; color:var(--text-dim); margin-top:16px; display:flex; align-items:center; justify-content:center; gap:6px; }

  /* ‚ïê‚ïê‚ïê FEATURES ‚ïê‚ïê‚ïê */
  .features { max-width:1200px; margin:60px auto 0; padding:0 40px 80px; display:grid; grid-template-columns:repeat(4,1fr); gap:16px; }
  .feature { background:var(--surface); border:1px solid var(--border); border-radius:var(--radius); padding:28px 24px; text-align:center; transition:transform 0.3s,border-color 0.3s; }
  .feature:hover { transform:translateY(-3px); border-color:rgba(255,255,255,0.1); }
  .feature-icon { font-size:1.6rem; margin-bottom:12px; width:52px; height:52px; display:flex; align-items:center; justify-content:center; margin:0 auto 12px; background:rgba(108,92,231,0.08); border-radius:14px; }
  .feature-title { font-weight:600; font-size:0.95rem; margin-bottom:6px; }
  .feature-desc { font-size:0.8rem; color:var(--text-dim); line-height:1.5; }

  /* ‚ïê‚ïê‚ïê FAQ ‚ïê‚ïê‚ïê */
  .faq { max-width:700px; margin:0 auto; padding:0 40px 100px; }
  .faq h2 { font-size:2rem; font-weight:800; text-align:center; margin-bottom:40px; letter-spacing:-0.5px; }
  .faq-item { border-bottom:1px solid var(--border); padding:20px 0; }
  .faq-q { font-weight:600; font-size:1rem; cursor:pointer; display:flex; justify-content:space-between; align-items:center; gap:16px; user-select:none; }
  .faq-q:hover { color:var(--accent-glow); }
  .faq-arrow { font-size:1.2rem; transition:transform 0.3s; flex-shrink:0; color:var(--text-dim); }
  .faq-item.open .faq-arrow { transform:rotate(180deg); }
  .faq-a { max-height:0; overflow:hidden; transition:max-height 0.35s ease,padding 0.35s ease; color:var(--text-dim); font-size:0.9rem; line-height:1.7; }
  .faq-item.open .faq-a { max-height:300px; padding-top:14px; }
  footer { border-top:1px solid var(--border); padding:24px 40px; text-align:center; font-size:0.8rem; color:var(--text-dim); max-width:1200px; margin:0 auto; }
  footer a { color:var(--text-dim); text-decoration:none; margin:0 12px; transition:color 0.2s; }
  footer a:hover { color:var(--text); }

  /* ‚ïê‚ïê‚ïê CHAT PAGE ‚ïê‚ïê‚ïê */
  .chat-nav { display:flex; align-items:center; justify-content:space-between; padding:12px 20px; background:var(--surface); border-bottom:1px solid var(--border); flex-shrink:0; }
  .chat-nav .logo { font-size:1.2rem; }
  .chat-nav .logo-icon { width:28px; height:28px; font-size:0.9rem; border-radius:8px; }
  .chat-status { display:flex; align-items:center; gap:8px; font-size:0.85rem; color:var(--text-dim); }
  .chat-status .status-indicator { width:8px; height:8px; border-radius:50%; }
  .chat-status .status-indicator.searching { background:#f39c12; animation:pulse 1s infinite; }
  .chat-status .status-indicator.connected { background:var(--green); box-shadow:0 0 6px var(--green); }
  .chat-status .status-indicator.disconnected { background:#e84393; }

  .chat-main { flex:1; display:flex; min-height:0; }

  /* Video Area */
  .video-area { flex:1; display:flex; flex-direction:column; background:#08080d; position:relative; }
  .video-grid { flex:1; display:grid; grid-template-columns:1fr 1fr; gap:2px; background:#000; min-height:0; }
  .vid-box { position:relative; background:#0a0a12; overflow:hidden; }
  .vid-box video { width:100%; height:100%; object-fit:cover; display:block; }
  .vid-label { position:absolute; bottom:12px; left:12px; font-size:0.7rem; font-weight:600; background:rgba(0,0,0,0.65); backdrop-filter:blur(6px); padding:4px 12px; border-radius:100px; letter-spacing:0.5px; z-index:2; text-transform:uppercase; }
  .vid-placeholder { display:flex; flex-direction:column; align-items:center; justify-content:center; height:100%; color:var(--text-dim); font-size:0.85rem; gap:8px; }
  .vid-placeholder-icon { font-size:3rem; opacity:0.3; }

  /* Controls Bar */
  .controls-bar { display:flex; align-items:center; justify-content:center; gap:12px; padding:14px 20px; background:var(--surface); border-top:1px solid var(--border); flex-shrink:0; }
  .ctrl-btn { width:46px; height:46px; border-radius:50%; border:1px solid var(--border); background:var(--surface-2); color:var(--text); font-size:1.1rem; cursor:pointer; display:flex; align-items:center; justify-content:center; transition:all 0.2s; }
  .ctrl-btn:hover { background:rgba(108,92,231,0.15); border-color:var(--accent); }
  .ctrl-btn.on { background:var(--accent); border-color:var(--accent); }
  .ctrl-btn.off { background:rgba(232,67,147,0.15); border-color:#e84393; color:#e84393; }
  .ctrl-btn.end { background:#e84393; border-color:#e84393; color:#fff; }
  .ctrl-btn.end:hover { background:#d63384; }
  .ctrl-btn.next { background:var(--accent); border-color:var(--accent); color:#fff; padding:0 20px; border-radius:23px; width:auto; font-weight:600; font-size:0.85rem; font-family:'Outfit',sans-serif; gap:6px; }
  .ctrl-btn.next:hover { background:#7c6ff0; }

  /* Sidebar Chat */
  .chat-sidebar { width:320px; display:flex; flex-direction:column; background:var(--surface); border-left:1px solid var(--border); }
  .chat-sidebar-header { padding:14px 16px; border-bottom:1px solid var(--border); font-weight:600; font-size:0.9rem; display:flex; align-items:center; justify-content:space-between; }
  .chat-messages-list { flex:1; overflow-y:auto; padding:12px; display:flex; flex-direction:column; gap:8px; }
  .chat-bubble { max-width:85%; padding:10px 14px; border-radius:14px; font-size:0.85rem; line-height:1.5; animation:msgIn 0.25s ease; }
  @keyframes msgIn { from{transform:translateY(6px);opacity:0} to{transform:translateY(0);opacity:1} }
  .chat-bubble.stranger { background:var(--surface-2); align-self:flex-start; border-bottom-left-radius:4px; }
  .chat-bubble.you { background:var(--accent); align-self:flex-end; border-bottom-right-radius:4px; }
  .chat-bubble .bubble-label { font-size:0.65rem; font-weight:600; text-transform:uppercase; letter-spacing:0.5px; opacity:0.5; margin-bottom:2px; }
  .chat-bubble.system { background:rgba(0,230,118,0.08); border:1px solid rgba(0,230,118,0.1); color:var(--green); align-self:center; text-align:center; font-size:0.8rem; border-radius:10px; max-width:100%; }
  .chat-input-bar { display:flex; gap:8px; padding:12px; border-top:1px solid var(--border); }
  .chat-input-bar input { flex:1; background:var(--surface-2); border:1px solid var(--border); border-radius:10px; padding:10px 14px; color:var(--text); font-family:'Outfit',sans-serif; font-size:0.85rem; outline:none; transition:border-color 0.2s; }
  .chat-input-bar input:focus { border-color:var(--accent); }
  .chat-input-bar button { background:var(--accent); border:none; color:#fff; border-radius:10px; padding:10px 18px; font-family:'Outfit',sans-serif; font-weight:600; font-size:0.85rem; cursor:pointer; transition:background 0.2s; }
  .chat-input-bar button:hover { background:#7c6ff0; }

  /* Report Modal */
  .report-overlay { position:fixed; inset:0; background:rgba(0,0,0,0.6); backdrop-filter:blur(6px); z-index:200; display:none; align-items:center; justify-content:center; }
  .report-overlay.active { display:flex; }
  .report-box { background:var(--surface); border:1px solid var(--border); border-radius:20px; padding:32px; max-width:400px; width:90%; animation:slideUp 0.3s ease; }
  @keyframes slideUp { from{transform:translateY(20px);opacity:0} to{transform:translateY(0);opacity:1} }
  .report-box h3 { font-size:1.2rem; margin-bottom:16px; }
  .report-option { display:block; width:100%; text-align:left; background:var(--surface-2); border:1px solid var(--border); border-radius:10px; padding:12px 16px; color:var(--text); font-family:'Outfit',sans-serif; font-size:0.9rem; cursor:pointer; margin-bottom:8px; transition:all 0.2s; }
  .report-option:hover { border-color:var(--accent); background:rgba(108,92,231,0.08); }
  .report-cancel { display:block; width:100%; text-align:center; background:none; border:none; color:var(--text-dim); font-family:'Outfit',sans-serif; font-size:0.85rem; cursor:pointer; margin-top:8px; padding:8px; }
  .report-cancel:hover { color:var(--text); }

  /* ‚ïê‚ïê‚ïê RESPONSIVE ‚Äî TABLET ‚ïê‚ïê‚ïê */
  @media(max-width:900px){
    .chat-sidebar { width: 260px; }
  }

  /* ‚ïê‚ïê‚ïê RESPONSIVE ‚Äî MOBILE (768px) ‚ïê‚ïê‚ïê */
  @media(max-width:768px){
    /* Landing page */
    nav { padding:16px 20px; }
    .logo { font-size:1.3rem; }
    .logo-icon { width:30px; height:30px; font-size:0.9rem; border-radius:8px; }
    .online-badge { padding:6px 12px; font-size:0.8rem; }
    .hero { padding:40px 20px 30px; }
    .hero h1 { font-size:2.6rem; letter-spacing:-1px; }
    .hero p { font-size:1rem; margin-bottom:32px; }
    .mode-cards { gap:14px; }
    .mode-card { padding:24px 32px; min-width:160px; }
    .mode-card-icon { font-size:2rem; margin-bottom:8px; }
    .mode-card-title { font-size:1.1rem; }
    .features { grid-template-columns:repeat(2,1fr); padding:0 20px 50px; gap:10px; }
    .feature { padding:20px 16px; }
    .feature-icon { width:44px; height:44px; font-size:1.3rem; }
    .faq { padding:0 20px 60px; }
    .faq h2 { font-size:1.5rem; margin-bottom:28px; }
    .interests-section { margin:0 auto 16px; }
    footer { padding:20px; }

    /* Chat page ‚Äî mobile layout */
    .chat-nav { padding:8px 12px; }
    .chat-nav .logo { font-size:1rem; gap:6px; }
    .chat-nav .logo-icon { width:24px; height:24px; font-size:0.75rem; border-radius:6px; }
    .chat-status { font-size:0.75rem; }
    .chat-main { flex-direction:column; position:relative; }
    .video-area { flex:1; display:flex; flex-direction:column; }

    /* Mobile video: stranger fills screen, you = small floating pip */
    .video-grid {
      grid-template-columns:1fr;
      grid-template-rows:1fr;
      flex:1;
      position:relative;
    }
    .video-grid .vid-box:first-child {
      /* Your video = floating picture-in-picture */
      position:absolute;
      top:12px; right:12px;
      width:110px; height:150px;
      border-radius:14px;
      border:2px solid rgba(255,255,255,0.15);
      z-index:10;
      box-shadow:0 4px 20px rgba(0,0,0,0.5);
    }
    .video-grid .vid-box:first-child .vid-label { display:none; }
    .video-grid .vid-box:last-child {
      /* Stranger video = full area */
      grid-row:1; grid-column:1;
    }

    /* Controls bar ‚Äî mobile */
    .controls-bar {
      padding:10px 16px;
      gap:10px;
      background:rgba(18,18,26,0.95);
      backdrop-filter:blur(10px);
      padding-bottom: calc(10px + env(safe-area-inset-bottom, 0px));
    }
    .ctrl-btn { width:44px; height:44px; font-size:1rem; }
    .ctrl-btn.next { padding:0 16px; font-size:0.8rem; }

    /* Chat sidebar ‚Äî hidden by default, slide up as overlay */
    .chat-sidebar {
      display:none;
      position:fixed;
      bottom:0; left:0; right:0;
      height:55vh;
      z-index:80;
      border-radius:20px 20px 0 0;
      border:none;
      border-top:1px solid var(--border);
      background:var(--surface);
      flex-direction:column;
      animation:slideUpChat 0.3s ease;
    }
    @keyframes slideUpChat {
      from { transform:translateY(100%); }
      to { transform:translateY(0); }
    }
    @keyframes slideDownChat {
      from { transform:translateY(0); }
      to { transform:translateY(100%); }
    }
    .chat-sidebar.mobile-open {
      display:flex;
    }
    .chat-sidebar-header {
      padding:12px 16px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      position:relative;
    }
    /* Drag handle indicator */
    .chat-sidebar-header::before {
      content:'';
      position:absolute;
      top:6px; left:50%;
      transform:translateX(-50%);
      width:36px; height:4px;
      background:rgba(255,255,255,0.15);
      border-radius:2px;
    }
    .chat-input-bar { padding-bottom:calc(12px + env(safe-area-inset-bottom, 0px)); }
  }

  /* ‚ïê‚ïê‚ïê RESPONSIVE ‚Äî SMALL PHONES (480px) ‚ïê‚ïê‚ïê */
  @media(max-width:480px){
    .hero h1 { font-size:2.2rem; }
    .hero p { font-size:0.9rem; }
    .features { grid-template-columns:1fr 1fr; gap:8px; }
    .feature { padding:16px 12px; }
    .feature-title { font-size:0.85rem; }
    .feature-desc { font-size:0.7rem; }
    .mode-cards { flex-direction:column; align-items:center; }
    .or-divider { margin:-6px 0; }
    .mode-card { min-width:auto; width:100%; max-width:280px; padding:20px 28px; }
    .video-grid .vid-box:first-child { width:90px; height:120px; top:8px; right:8px; }
    .controls-bar { gap:8px; padding:8px 12px; }
    .ctrl-btn { width:40px; height:40px; font-size:0.95rem; }
    .ctrl-btn.next { padding:0 12px; font-size:0.75rem; }
  }

  /* ‚ïê‚ïê‚ïê MOBILE CHAT TOGGLE BUTTON ‚ïê‚ïê‚ïê */
  .mobile-chat-toggle {
    display:none;
    position:fixed;
    bottom:76px; right:16px;
    z-index:50;
    width:52px; height:52px;
    border-radius:50%;
    background:var(--accent);
    border:2px solid rgba(255,255,255,0.1);
    color:#fff;
    font-size:1.2rem;
    align-items:center;
    justify-content:center;
    cursor:pointer;
    box-shadow:0 4px 24px rgba(108,92,231,0.5);
    transition:transform 0.2s, background 0.2s;
    -webkit-tap-highlight-color:transparent;
  }
  .mobile-chat-toggle:active { transform:scale(0.9); }
  .mobile-chat-toggle .chat-badge {
    position:absolute;
    top:-2px; right:-2px;
    width:18px; height:18px;
    background:var(--red);
    border-radius:50%;
    font-size:0.6rem;
    font-weight:700;
    display:none;
    align-items:center;
    justify-content:center;
    border:2px solid var(--bg);
  }
  .mobile-chat-toggle .chat-badge.has-msg {
    display:flex;
  }

  /* Mobile close button inside sidebar */
  .mobile-chat-close {
    display:none;
    background:none; border:none;
    color:var(--text-dim);
    font-size:1.3rem;
    cursor:pointer;
    padding:4px 8px;
    border-radius:8px;
    -webkit-tap-highlight-color:transparent;
  }
  .mobile-chat-close:active { background:var(--surface-2); }

  @media(max-width:768px){
    .mobile-chat-toggle { display:flex; }
    .mobile-chat-close { display:block; }
    /* Adjust toggle position when controls have safe area */
    .mobile-chat-toggle {
      bottom:calc(76px + env(safe-area-inset-bottom, 0px));
    }
  }

  /* ‚ïê‚ïê‚ïê LANDSCAPE MOBILE ‚ïê‚ïê‚ïê */
  @media(max-height:500px) and (orientation:landscape){
    .video-grid {
      grid-template-columns:1fr 1fr;
      grid-template-rows:1fr;
    }
    .video-grid .vid-box:first-child {
      position:static;
      width:auto; height:auto;
      border:none; border-radius:0;
      box-shadow:none;
    }
    .video-grid .vid-box:first-child .vid-label { display:block; }
    .controls-bar { padding:6px 12px; }
    .ctrl-btn { width:36px; height:36px; font-size:0.85rem; }
    .chat-nav { padding:4px 12px; }
  }
  /* ‚ïê‚ïê‚ïê LEGAL PAGES ‚ïê‚ïê‚ïê */
  .legal-content {
    max-width:760px; margin:0 auto; padding:20px 40px 80px;
    line-height:1.8; font-size:0.92rem; color:var(--text-dim);
  }
  .legal-content h1 {
    font-size:2.2rem; font-weight:800; color:var(--text);
    margin-bottom:8px; letter-spacing:-0.5px;
  }
  .legal-content .legal-updated {
    font-size:0.8rem; color:var(--accent-glow); margin-bottom:32px;
    font-weight:500;
  }
  .legal-content h2 {
    font-size:1.15rem; font-weight:700; color:var(--text);
    margin-top:32px; margin-bottom:10px;
  }
  .legal-content h3 {
    font-size:0.95rem; font-weight:600; color:var(--text);
    margin-top:20px; margin-bottom:8px;
  }
  .legal-content p {
    margin-bottom:14px;
  }
  .legal-content strong { color:var(--text); }
  @media(max-width:768px){
    .legal-content { padding:16px 20px 60px; }
    .legal-content h1 { font-size:1.7rem; }
  }

  /* ‚ïê‚ïê‚ïê USERNAME MODAL ‚ïê‚ïê‚ïê */
  .username-overlay {
    position:fixed; inset:0; background:rgba(0,0,0,0.85); backdrop-filter:blur(12px);
    z-index:250; display:none; align-items:center; justify-content:center; padding:20px;
  }
  .username-overlay.active { display:flex; }
  .username-box {
    background:var(--surface); border:1px solid var(--border); border-radius:20px;
    padding:36px 28px; max-width:360px; width:100%; text-align:center;
    animation:slideUp 0.3s ease;
  }
  .username-box h2 { font-size:1.3rem; font-weight:800; margin-bottom:6px; }
  .username-box .usub { font-size:0.8rem; color:var(--text-dim); margin-bottom:20px; line-height:1.5; }
  .username-box input {
    width:100%; padding:14px 16px; background:var(--surface-2); border:1px solid var(--border);
    border-radius:12px; color:var(--text); font-family:'Outfit',sans-serif; font-size:1rem;
    text-align:center; outline:none; margin-bottom:14px; letter-spacing:0.5px;
  }
  .username-box input:focus { border-color:var(--accent); }
  .username-box .uname-error { color:var(--red); font-size:0.75rem; margin-bottom:10px; display:none; }
  .username-box button {
    width:100%; padding:14px; background:linear-gradient(135deg,var(--accent),#e84393);
    border:none; border-radius:12px; color:#fff; font-family:'Outfit',sans-serif;
    font-weight:700; font-size:1rem; cursor:pointer; transition:transform 0.2s;
  }
  .username-box button:hover { transform:translateY(-2px); }
  .username-box button:active { transform:scale(0.97); }

  /* ‚ïê‚ïê‚ïê FRIENDS SYSTEM ‚ïê‚ïê‚ïê */
  .friends-btn { background:linear-gradient(135deg,#00b894,#00cec9) !important; color:#fff !important; border-color:#00b894 !important; }
  .add-friend-btn { background:linear-gradient(135deg,#00b894,#00cec9) !important; color:#fff !important; border-color:#00b894 !important; font-size:0.8rem !important; padding:0 14px !important; border-radius:20px !important; width:auto !important; font-family:'Outfit',sans-serif; font-weight:600; gap:4px; }
  .friend-added-toast { position:fixed; top:80px; left:50%; transform:translateX(-50%); background:linear-gradient(135deg,#00b894,#00cec9); color:#fff; padding:12px 24px; border-radius:12px; font-family:'Outfit',sans-serif; font-weight:700; font-size:0.9rem; z-index:300; animation:slideUp 0.3s ease, entranceFade 3s ease forwards; }

  .friends-overlay {
    position:fixed; inset:0; background:rgba(0,0,0,0.85); backdrop-filter:blur(8px);
    z-index:210; display:none; align-items:flex-start; justify-content:center; padding:20px; overflow-y:auto;
  }
  .friends-overlay.active { display:flex; }
  .friends-panel {
    background:var(--surface); border:1px solid var(--border); border-radius:20px;
    padding:24px; max-width:440px; width:100%; margin-top:40px; animation:slideUp 0.3s ease;
  }
  .friends-panel h3 { font-size:1.2rem; font-weight:800; text-align:center; margin-bottom:4px; }
  .friends-panel .fp-sub { text-align:center; font-size:0.8rem; color:var(--text-dim); margin-bottom:16px; }
  .friend-item {
    display:flex; align-items:center; gap:12px; padding:12px 14px;
    background:var(--surface-2); border:1px solid var(--border); border-radius:12px;
    margin-bottom:8px; transition:all 0.2s;
  }
  .friend-item:hover { border-color:var(--accent); }
  .friend-avatar { width:36px; height:36px; border-radius:50%; background:var(--surface-3); display:flex; align-items:center; justify-content:center; font-size:1.1rem; flex-shrink:0; }
  .friend-info { flex:1; min-width:0; }
  .friend-name { font-weight:700; font-size:0.9rem; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
  .friend-status { font-size:0.7rem; color:var(--text-dim); }
  .friend-status.online { color:var(--green); }
  .friend-actions { display:flex; gap:6px; flex-shrink:0; }
  .friend-action-btn { padding:6px 12px; border-radius:8px; border:none; font-family:'Outfit',sans-serif; font-size:0.7rem; font-weight:600; cursor:pointer; }
  .friend-action-btn.msg { background:var(--accent); color:#fff; }
  .friend-action-btn.remove { background:var(--surface-3); color:var(--red); }
  .friends-empty { text-align:center; padding:24px; color:var(--text-dim); font-size:0.85rem; line-height:1.6; }
  .friends-close { display:block; width:100%; text-align:center; background:none; border:none; color:var(--text-dim); font-family:'Outfit',sans-serif; font-size:0.85rem; cursor:pointer; margin-top:8px; padding:8px; }

  /* DM Chat */
  .dm-overlay {
    position:fixed; inset:0; background:rgba(0,0,0,0.9); backdrop-filter:blur(8px);
    z-index:220; display:none; align-items:center; justify-content:center; padding:20px;
  }
  .dm-overlay.active { display:flex; }
  .dm-box {
    background:var(--surface); border:1px solid var(--border); border-radius:20px;
    max-width:440px; width:100%; height:500px; max-height:80vh; display:flex; flex-direction:column;
    animation:slideUp 0.3s ease; overflow:hidden;
  }
  .dm-header { display:flex; align-items:center; justify-content:space-between; padding:14px 18px; border-bottom:1px solid var(--border); }
  .dm-header-name { font-weight:700; font-size:1rem; }
  .dm-header-close { background:none; border:none; color:var(--text-dim); font-size:1.2rem; cursor:pointer; }
  .dm-messages { flex:1; overflow-y:auto; padding:14px; display:flex; flex-direction:column; gap:8px; }
  .dm-bubble { max-width:80%; padding:8px 14px; border-radius:14px; font-size:0.85rem; line-height:1.4; word-wrap:break-word; }
  .dm-bubble.me { align-self:flex-end; background:var(--accent); color:#fff; border-bottom-right-radius:4px; }
  .dm-bubble.them { align-self:flex-start; background:var(--surface-2); border:1px solid var(--border); border-bottom-left-radius:4px; }
  .dm-bubble.sys { align-self:center; background:none; color:var(--text-dim); font-size:0.75rem; }
  .dm-input-bar { display:flex; gap:8px; padding:12px; border-top:1px solid var(--border); }
  .dm-input-bar input { flex:1; padding:10px 14px; background:var(--surface-2); border:1px solid var(--border); border-radius:10px; color:var(--text); font-family:'Outfit',sans-serif; font-size:0.85rem; outline:none; }
  .dm-input-bar input:focus { border-color:var(--accent); }
  .dm-input-bar button { padding:10px 18px; background:var(--accent); border:none; border-radius:10px; color:#fff; font-family:'Outfit',sans-serif; font-weight:700; font-size:0.85rem; cursor:pointer; }

  /* ‚ïê‚ïê‚ïê LEADERBOARD ‚ïê‚ïê‚ïê */
  .leaderboard { max-width:480px; margin:0 auto 40px; padding:0 20px; }
  .leaderboard h2 { text-align:center; font-size:1.3rem; font-weight:800; margin-bottom:16px; }
  .lb-list { background:var(--surface); border:1px solid var(--border); border-radius:16px; overflow:hidden; }
  .lb-item {
    display:flex; align-items:center; gap:12px; padding:12px 16px;
    border-bottom:1px solid var(--border); transition:background 0.2s;
  }
  .lb-item:last-child { border-bottom:none; }
  .lb-item:hover { background:var(--surface-2); }
  .lb-rank {
    width:32px; height:32px; display:flex; align-items:center; justify-content:center;
    border-radius:50%; font-weight:800; font-size:0.85rem; flex-shrink:0;
  }
  .lb-rank-1 { background:linear-gradient(135deg,#f1c40f,#f39c12); color:#000; }
  .lb-rank-2 { background:linear-gradient(135deg,#bdc3c7,#95a5a6); color:#000; }
  .lb-rank-3 { background:linear-gradient(135deg,#e67e22,#d35400); color:#fff; }
  .lb-rank-other { background:var(--surface-3); color:var(--text-dim); }
  .lb-name { flex:1; font-weight:700; font-size:0.95rem; }
  .lb-coins { font-weight:800; color:#f1c40f; font-size:0.9rem; white-space:nowrap; }
  .lb-empty { text-align:center; padding:24px; color:var(--text-dim); font-size:0.85rem; }
  .lb-crown { font-size:1.1rem; }

  /* ‚ïê‚ïê‚ïê ENTRANCE EFFECTS ‚ïê‚ïê‚ïê */
  .entrance-overlay {
    position:fixed; inset:0; z-index:180; pointer-events:none;
    display:flex; align-items:center; justify-content:center;
    animation:entranceFade 3s ease forwards;
  }
  .entrance-overlay .ent-content {
    text-align:center; animation:entrancePop 0.6s cubic-bezier(0.175,0.885,0.32,1.275);
  }
  .entrance-overlay .ent-emoji { font-size:4rem; margin-bottom:8px; }
  .entrance-overlay .ent-text {
    font-family:'Outfit',sans-serif; font-weight:800; font-size:1.3rem;
    color:#fff; text-shadow:0 4px 20px rgba(0,0,0,0.7);
  }
  .entrance-overlay .ent-sub { font-size:0.8rem; color:rgba(255,255,255,0.7); margin-top:4px; }
  .entrance-fire { background:radial-gradient(circle at 50% 60%, rgba(255,69,0,0.4), transparent 70%); }
  .entrance-star { background:radial-gradient(circle at 50% 60%, rgba(255,215,0,0.4), transparent 70%); }
  .entrance-crown { background:radial-gradient(circle at 50% 60%, rgba(138,43,226,0.4), transparent 70%); }
  .entrance-diamond { background:radial-gradient(circle at 50% 60%, rgba(0,191,255,0.4), transparent 70%); }
  .entrance-rocket { background:radial-gradient(circle at 50% 60%, rgba(255,99,71,0.4), transparent 70%); }
  @keyframes entrancePop { 0%{transform:scale(0) rotate(-10deg);opacity:0} 100%{transform:scale(1) rotate(0);opacity:1} }
  @keyframes entranceFade { 0%{opacity:1} 70%{opacity:1} 100%{opacity:0} }

  /* ‚ïê‚ïê‚ïê NAME COLORS ‚ïê‚ïê‚ïê */
  .name-gold { color:#f1c40f !important; }
  .name-purple { color:#a55eea !important; }
  .name-red { color:#e84393 !important; }
  .name-cyan { color:#00cec9 !important; }
  .name-green { color:#00b894 !important; }
  .name-rainbow { background:linear-gradient(90deg,#f1c40f,#e84393,#a55eea,#00cec9,#00b894,#f1c40f); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text; font-weight:800 !important; }

  /* ‚ïê‚ïê‚ïê BUBBLE THEMES ‚ïê‚ïê‚ïê */
  .bubble-neon .chat-bubble.stranger { background:rgba(0,255,157,0.1); border:1px solid rgba(0,255,157,0.4); box-shadow:0 0 12px rgba(0,255,157,0.15); }
  .bubble-gradient .chat-bubble.stranger { background:linear-gradient(135deg,rgba(108,92,231,0.2),rgba(232,67,147,0.2)); border:1px solid rgba(108,92,231,0.3); }
  .bubble-dark .chat-bubble.stranger { background:rgba(0,0,0,0.6); border:1px solid rgba(255,255,255,0.1); }
  .bubble-retro .chat-bubble.stranger { background:rgba(255,165,0,0.15); border:1px solid rgba(255,165,0,0.3); font-family:monospace; }
  .bubble-royal .chat-bubble.stranger { background:linear-gradient(135deg,rgba(255,215,0,0.15),rgba(139,69,19,0.15)); border:1px solid rgba(255,215,0,0.4); }

  /* ‚ïê‚ïê‚ïê PERKS SHOP MODAL ‚ïê‚ïê‚ïê */
  .perks-overlay {
    position:fixed; inset:0; background:rgba(0,0,0,0.85); backdrop-filter:blur(8px);
    z-index:210; display:none; align-items:flex-start; justify-content:center; padding:20px; overflow-y:auto;
  }
  .perks-overlay.active { display:flex; }
  .perks-shop {
    background:var(--surface); border:1px solid var(--border); border-radius:20px;
    padding:24px; max-width:440px; width:100%; margin-top:40px; margin-bottom:40px;
    animation:slideUp 0.3s ease;
  }
  .perks-shop h3 { font-size:1.2rem; font-weight:800; text-align:center; margin-bottom:4px; }
  .perks-shop .ps-sub { text-align:center; font-size:0.8rem; color:var(--text-dim); margin-bottom:16px; }
  .perks-section { margin-bottom:20px; }
  .perks-section h4 { font-size:0.85rem; font-weight:700; margin-bottom:8px; display:flex; align-items:center; gap:6px; }
  .perk-grid { display:grid; grid-template-columns:repeat(3,1fr); gap:6px; }
  .perk-item {
    display:flex; flex-direction:column; align-items:center; gap:3px;
    padding:10px 6px; border-radius:10px; background:var(--surface-2); border:2px solid var(--border);
    cursor:pointer; transition:all 0.2s; text-align:center;
  }
  .perk-item:hover { border-color:var(--accent); }
  .perk-item:active { transform:scale(0.95); }
  .perk-item.equipped { border-color:#f1c40f; background:rgba(241,196,15,0.08); }
  .perk-item .pi-icon { font-size:1.3rem; }
  .perk-item .pi-name { font-size:0.65rem; font-weight:600; color:var(--text); }
  .perk-item .pi-cost { font-size:0.6rem; color:#f1c40f; font-weight:700; }
  .perk-item .pi-owned { font-size:0.6rem; color:var(--green); font-weight:700; }
  .perk-color-swatch { width:24px; height:24px; border-radius:50%; display:inline-block; }
  .perk-color-rainbow { background:conic-gradient(#f1c40f,#e84393,#a55eea,#00cec9,#00b894,#f1c40f); }
  .perks-close { display:block; width:100%; text-align:center; background:none; border:none; color:var(--text-dim); font-family:'Outfit',sans-serif; font-size:0.85rem; cursor:pointer; margin-top:8px; padding:8px; }
  .perks-close:hover { color:var(--text); }
  .reconnect-btn { background:linear-gradient(135deg,#e84393,#fd79a8) !important; font-size:0.75rem !important; }
  @media(max-width:480px){ .perk-grid { grid-template-columns:repeat(2,1fr); } }

  /* ‚ïê‚ïê‚ïê GIFT SYSTEM ‚ïê‚ïê‚ïê */
  .coin-display { display:flex; align-items:center; gap:5px; background:linear-gradient(135deg,#f39c12,#f1c40f); padding:4px 12px; border-radius:100px; font-weight:700; font-size:0.8rem; color:#000; cursor:pointer; transition:transform 0.2s; }
  .coin-display:hover { transform:scale(1.05); }
  .coin-display .coin-icon { font-size:0.9rem; }
  .gift-btn { background:linear-gradient(135deg,#e84393,#fd79a8) !important; position:relative; }
  .gift-btn.has-coins::after { content:''; position:absolute; top:-2px; right:-2px; width:8px; height:8px; background:#f1c40f; border-radius:50%; }

  .gift-tray {
    display:none; position:absolute; bottom:70px; left:50%; transform:translateX(-50%);
    background:var(--surface); border:1px solid var(--border); border-radius:16px;
    padding:12px; z-index:60; width:320px; max-width:90vw;
    box-shadow:0 8px 40px rgba(0,0,0,0.5); animation:slideUp 0.3s ease;
  }
  .gift-tray.active { display:block; }
  .gift-tray-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:10px; padding:0 4px; }
  .gift-tray-header span { font-size:0.85rem; font-weight:700; }
  .gift-tray-close { background:none; border:none; color:var(--text-dim); cursor:pointer; font-size:1.1rem; }
  .gift-grid { display:grid; grid-template-columns:repeat(4,1fr); gap:8px; }
  .gift-item {
    display:flex; flex-direction:column; align-items:center; gap:2px;
    padding:10px 4px; border-radius:12px; background:var(--surface-2);
    border:1px solid var(--border); cursor:pointer; transition:all 0.2s;
    -webkit-tap-highlight-color:transparent;
  }
  .gift-item:hover { border-color:var(--accent); background:rgba(108,92,231,0.1); }
  .gift-item:active { transform:scale(0.92); }
  .gift-item .gift-emoji { font-size:1.5rem; }
  .gift-item .gift-name { font-size:0.6rem; color:var(--text-dim); }
  .gift-item .gift-cost { font-size:0.65rem; font-weight:700; color:#f1c40f; }
  .gift-tray-buy { display:block; width:100%; margin-top:10px; padding:8px; background:linear-gradient(135deg,#f39c12,#f1c40f); border:none; border-radius:10px; color:#000; font-family:'Outfit',sans-serif; font-weight:700; font-size:0.8rem; cursor:pointer; }
  .gift-tray-buy:hover { opacity:0.9; }

  /* Floating gift animation */
  .gift-float {
    position:fixed; z-index:200; pointer-events:none;
    animation:giftFloat 3s ease-out forwards;
    text-align:center;
  }
  .gift-float .gf-emoji { font-size:3rem; animation:giftPop 0.4s ease; }
  .gift-float .gf-label { font-size:0.7rem; font-weight:700; color:#fff; text-shadow:0 2px 8px rgba(0,0,0,0.6); white-space:nowrap; }
  @keyframes giftFloat {
    0% { opacity:1; transform:translateY(0) scale(1); }
    20% { transform:translateY(-40px) scale(1.2); }
    100% { opacity:0; transform:translateY(-200px) scale(0.6); }
  }
  @keyframes giftPop {
    0% { transform:scale(0); } 50% { transform:scale(1.4); } 100% { transform:scale(1); }
  }

  /* Coin Shop Modal */
  .coin-shop-overlay {
    position:fixed; inset:0; background:rgba(0,0,0,0.8); backdrop-filter:blur(8px);
    z-index:200; display:none; align-items:center; justify-content:center; padding:20px;
  }
  .coin-shop-overlay.active { display:flex; }
  .coin-shop {
    background:var(--surface); border:1px solid var(--border); border-radius:20px;
    padding:28px 24px; max-width:380px; width:100%; animation:slideUp 0.3s ease;
  }
  .coin-shop h3 { font-size:1.2rem; font-weight:800; text-align:center; margin-bottom:4px; }
  .coin-shop .shop-sub { font-size:0.8rem; color:var(--text-dim); text-align:center; margin-bottom:20px; }
  .coin-shop .shop-balance { text-align:center; margin-bottom:16px; font-size:0.85rem; color:var(--text-dim); }
  .coin-shop .shop-balance strong { color:#f1c40f; font-size:1.1rem; }
  .coin-pack {
    display:flex; align-items:center; justify-content:space-between;
    padding:14px 16px; background:var(--surface-2); border:1px solid var(--border);
    border-radius:12px; margin-bottom:8px; cursor:pointer; transition:all 0.2s;
  }
  .coin-pack:hover { border-color:#f1c40f; background:rgba(241,196,15,0.05); }
  .coin-pack .pack-coins { font-weight:800; font-size:1rem; color:#f1c40f; }
  .coin-pack .pack-price { font-size:0.85rem; font-weight:700; color:var(--text); }
  .coin-pack .pack-bonus { font-size:0.65rem; color:var(--green); font-weight:600; }
  .coin-shop-close { display:block; width:100%; text-align:center; background:none; border:none; color:var(--text-dim); font-family:'Outfit',sans-serif; font-size:0.85rem; cursor:pointer; margin-top:12px; padding:8px; }
  .coin-shop-close:hover { color:var(--text); }
  #coinShopPaypal { min-height:40px; margin-top:12px; }
  .selected-pack { border-color:#f1c40f !important; background:rgba(241,196,15,0.1) !important; }

  /* ‚ïê‚ïê‚ïê ADMIN PANEL ‚ïê‚ïê‚ïê */
  .admin-login { max-width:380px; margin:80px auto; padding:40px 32px; background:var(--surface); border:1px solid var(--border); border-radius:20px; text-align:center; }
  .admin-login h2 { font-size:1.4rem; margin-bottom:6px; }
  .admin-login .admin-sub { font-size:0.8rem; color:var(--text-dim); margin-bottom:24px; }
  .admin-input { width:100%; padding:12px 16px; background:var(--surface-2); border:1px solid var(--border); border-radius:10px; color:var(--text); font-family:'Outfit',sans-serif; font-size:0.9rem; margin-bottom:12px; outline:none; }
  .admin-input:focus { border-color:var(--accent); }
  .admin-login-btn { width:100%; padding:12px; background:var(--accent); border:none; border-radius:10px; color:#fff; font-family:'Outfit',sans-serif; font-weight:700; font-size:0.95rem; cursor:pointer; transition:background 0.2s; }
  .admin-login-btn:hover { background:#5b4bd5; }
  .admin-error { color:var(--red); font-size:0.8rem; margin-top:8px; display:none; }
  .admin-dash { max-width:1000px; margin:0 auto; padding:20px; }
  .admin-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:24px; }
  .admin-header h1 { font-size:1.4rem; font-weight:800; }
  .admin-logout { background:none; border:1px solid var(--border); color:var(--text-dim); padding:8px 16px; border-radius:8px; font-family:'Outfit',sans-serif; font-size:0.8rem; cursor:pointer; }
  .admin-logout:hover { border-color:var(--red); color:var(--red); }
  .stat-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(140px,1fr)); gap:12px; margin-bottom:28px; }
  .stat-card { background:var(--surface); border:1px solid var(--border); border-radius:14px; padding:18px 16px; text-align:center; }
  .stat-num { font-size:1.8rem; font-weight:800; color:var(--accent-glow); }
  .stat-label { font-size:0.75rem; color:var(--text-dim); margin-top:4px; text-transform:uppercase; letter-spacing:0.5px; }
  .stat-card.green .stat-num { color:var(--green); }
  .stat-card.red .stat-num { color:var(--red); }
  .admin-section { background:var(--surface); border:1px solid var(--border); border-radius:16px; padding:20px; margin-bottom:20px; }
  .admin-section h3 { font-size:1rem; font-weight:700; margin-bottom:14px; display:flex; align-items:center; gap:8px; }
  .admin-table { width:100%; border-collapse:collapse; font-size:0.8rem; }
  .admin-table th { text-align:left; color:var(--text-dim); font-weight:600; padding:8px 10px; border-bottom:1px solid var(--border); font-size:0.7rem; text-transform:uppercase; letter-spacing:0.5px; }
  .admin-table td { padding:8px 10px; border-bottom:1px solid var(--border); vertical-align:middle; }
  .admin-table tr:last-child td { border-bottom:none; }
  .admin-table .ip { font-family:monospace; font-size:0.75rem; color:var(--accent-glow); }
  .admin-action-btn { padding:4px 12px; border-radius:6px; border:none; font-family:'Outfit',sans-serif; font-size:0.7rem; font-weight:600; cursor:pointer; }
  .admin-action-btn.ban { background:var(--red); color:#fff; }
  .admin-action-btn.unban { background:var(--green); color:#000; }
  .admin-action-btn.kick { background:var(--surface-3); color:var(--text); }
  .admin-action-row { display:flex; gap:8px; margin-bottom:12px; }
  .admin-action-row input { flex:1; padding:10px 14px; background:var(--surface-2); border:1px solid var(--border); border-radius:8px; color:var(--text); font-family:'Outfit',sans-serif; font-size:0.85rem; outline:none; }
  .admin-action-row input:focus { border-color:var(--accent); }
  .admin-action-row button { padding:10px 20px; border-radius:8px; border:none; font-family:'Outfit',sans-serif; font-weight:700; font-size:0.85rem; cursor:pointer; white-space:nowrap; }
  .admin-refresh { background:none; border:1px solid var(--border); color:var(--text-dim); padding:6px 14px; border-radius:8px; font-family:'Outfit',sans-serif; font-size:0.75rem; cursor:pointer; }
  .admin-refresh:hover { border-color:var(--accent); color:var(--accent); }
  .admin-badge { display:inline-block; padding:2px 8px; border-radius:4px; font-size:0.65rem; font-weight:700; text-transform:uppercase; }
  .admin-badge.active { background:rgba(232,67,147,0.15); color:var(--red); }
  .admin-badge.paid { background:rgba(0,230,118,0.15); color:var(--green); }
  .admin-badge.online { background:rgba(0,230,118,0.15); color:var(--green); }
  .admin-badge.paired { background:rgba(108,92,231,0.15); color:var(--accent-glow); }
  .empty-msg { text-align:center; color:var(--text-dim); padding:20px; font-size:0.85rem; }
  @media(max-width:768px){
    .admin-dash { padding:12px; }
    .stat-grid { grid-template-columns:repeat(2,1fr); }
    .admin-action-row { flex-direction:column; }
    .admin-table { font-size:0.7rem; }
  }

  /* ‚ïê‚ïê‚ïê RULES SCREEN ‚ïê‚ïê‚ïê */
  .rules-overlay {
    position:fixed; inset:0; background:rgba(0,0,0,0.92); backdrop-filter:blur(10px);
    z-index:205; display:none; align-items:center; justify-content:center; padding:20px;
  }
  .rules-overlay.active { display:flex; }
  .rules-box {
    background:var(--surface); border:1px solid var(--border); border-radius:20px;
    padding:32px 28px; max-width:440px; width:100%; animation:slideUp 0.3s ease; text-align:center;
  }
  .rules-box h2 { font-size:1.3rem; font-weight:800; margin-bottom:6px; }
  .rules-box .rules-sub { font-size:0.8rem; color:var(--text-dim); margin-bottom:20px; }
  .rules-list { text-align:left; margin-bottom:24px; display:flex; flex-direction:column; gap:12px; }
  .rule-item { display:flex; align-items:flex-start; gap:10px; font-size:0.85rem; line-height:1.4; }
  .rule-icon { font-size:1.2rem; flex-shrink:0; margin-top:1px; }
  .rules-box button { width:100%; padding:14px; background:var(--accent); border:none; border-radius:12px; color:#fff; font-family:'Outfit',sans-serif; font-size:1rem; font-weight:700; cursor:pointer; }
  .rules-box button:hover { background:#7c6ff0; }
  .rules-check { display:flex; align-items:center; gap:8px; margin-bottom:16px; font-size:0.8rem; color:var(--text-dim); cursor:pointer; justify-content:center; }
  .rules-check input { width:16px; height:16px; accent-color:var(--accent); cursor:pointer; }

  /* ‚ïê‚ïê‚ïê SKIP CONFIRM ‚ïê‚ïê‚ïê */
  .skip-confirm-toast {
    position:fixed; bottom:100px; left:50%; transform:translateX(-50%);
    background:rgba(232,67,147,0.9); color:#fff; padding:10px 20px; border-radius:10px;
    font-family:'Outfit',sans-serif; font-weight:600; font-size:0.85rem; z-index:300;
    animation:slideUp 0.2s ease; pointer-events:none;
  }

  /* ‚ïê‚ïê‚ïê DISCORD BADGE ‚ïê‚ïê‚ïê */
  .discord-badge {
    position:fixed; right:16px; top:50%; transform:translateY(-50%); z-index:100;
    background:var(--surface); border:1px solid var(--border); border-radius:14px;
    padding:14px 12px; display:flex; flex-direction:column; align-items:center; gap:8px;
    text-decoration:none; color:var(--text); transition:all 0.3s; cursor:pointer;
    box-shadow:0 4px 20px rgba(0,0,0,0.3);
  }
  .discord-badge:hover { border-color:#5865F2; box-shadow:0 4px 24px rgba(88,101,242,0.3); transform:translateY(-50%) scale(1.05); }
  .discord-badge svg { width:28px; height:28px; fill:#5865F2; }
  .discord-badge .dc-user { font-size:0.7rem; font-weight:700; color:#5865F2; white-space:nowrap; }
  .discord-badge .dc-sub { font-size:0.55rem; color:var(--text-dim); text-align:center; line-height:1.3; max-width:90px; }
  @media(max-width:768px) {
    .discord-badge { right:8px; padding:10px 8px; border-radius:12px; }
    .discord-badge svg { width:22px; height:22px; }
    .discord-badge .dc-user { font-size:0.6rem; }
    .discord-badge .dc-sub { font-size:0.5rem; max-width:70px; }
  }
  @media(max-width:480px) {
    .discord-badge { right:6px; top:auto; bottom:80px; transform:none; padding:8px 6px; border-radius:10px; }
    .discord-badge:hover { transform:scale(1.05); }
  }

  /* ‚ïê‚ïê‚ïê BAN SCREEN ‚ïê‚ïê‚ïê */
  .ban-overlay {
    position:fixed; inset:0; background:rgba(0,0,0,0.85);
    backdrop-filter:blur(12px); z-index:300;
    display:none; align-items:center; justify-content:center;
    padding:20px;
  }
  .ban-overlay.active { display:flex; }
  .ban-box {
    background:var(--surface); border:1px solid rgba(232,67,147,0.3);
    border-radius:24px; padding:40px 32px; max-width:440px; width:100%;
    text-align:center; animation:slideUp 0.4s ease;
  }
  .ban-icon { font-size:3.5rem; margin-bottom:16px; }
  .ban-box h2 { font-size:1.5rem; font-weight:800; margin-bottom:8px; color:#e84393; }
  .ban-box .ban-reason {
    font-size:0.9rem; color:var(--text-dim); margin-bottom:24px;
    background:var(--surface-2); padding:12px 16px; border-radius:10px;
    line-height:1.5;
  }
  .ban-box .ban-message {
    font-size:0.85rem; color:var(--text-dim); margin-bottom:28px; line-height:1.6;
  }
  .unban-btn {
    display:inline-flex; align-items:center; gap:8px;
    background:linear-gradient(135deg,var(--accent),#e84393);
    border:none; color:#fff; padding:14px 32px;
    border-radius:12px; font-family:'Outfit',sans-serif;
    font-size:1rem; font-weight:700; cursor:pointer;
    transition:transform 0.2s, box-shadow 0.2s;
    box-shadow:0 4px 20px rgba(108,92,231,0.3);
  }
  .unban-btn:hover { transform:translateY(-2px); box-shadow:0 8px 30px rgba(108,92,231,0.4); }
  .unban-btn:active { transform:scale(0.97); }
  .unban-price { font-size:0.75rem; opacity:0.8; margin-top:8px; }

  /* Warning toast */
  .warning-toast {
    position:fixed; top:20px; left:50%; transform:translateX(-50%);
    background:linear-gradient(135deg,#e84393,#fd79a8);
    color:#fff; padding:14px 24px; border-radius:14px;
    font-size:0.85rem; font-weight:600; z-index:250;
    box-shadow:0 8px 30px rgba(232,67,147,0.4);
    animation:toastIn 0.4s ease, toastOut 0.4s ease 4.6s forwards;
    max-width:90%; text-align:center; line-height:1.4;
  }
  @keyframes toastIn { from{transform:translateX(-50%) translateY(-30px);opacity:0} to{transform:translateX(-50%) translateY(0);opacity:1} }
  @keyframes toastOut { to{transform:translateX(-50%) translateY(-30px);opacity:0} }
</style>
</head>
<body>

<div class="bg-orbs"><div class="orb"></div><div class="orb"></div><div class="orb"></div></div>

<!-- Discord Badge -->
<a class="discord-badge" href="https://discord.gg/wuatY54yCY" target="_blank" rel="noopener" title="Join our Discord">
  <svg viewBox="0 0 127.14 96.36" xmlns="http://www.w3.org/2000/svg"><path d="M107.7 8.07A105.15 105.15 0 0 0 81.47 0a72.06 72.06 0 0 0-3.36 6.83 97.68 97.68 0 0 0-29.11 0A72.37 72.37 0 0 0 45.64 0 105.89 105.89 0 0 0 19.39 8.09C2.79 32.65-1.71 56.6.54 80.21a105.73 105.73 0 0 0 32.17 16.15 77.7 77.7 0 0 0 6.89-11.11 68.42 68.42 0 0 1-10.85-5.18c.91-.66 1.8-1.34 2.66-2.03a75.57 75.57 0 0 0 64.32 0c.87.71 1.76 1.39 2.66 2.03a68.68 68.68 0 0 1-10.87 5.19 77 77 0 0 0 6.89 11.1 105.25 105.25 0 0 0 32.19-16.14c2.64-27.38-4.51-51.11-18.9-72.15ZM42.45 65.69C36.18 65.69 31 60 31 53.05c0-6.94 5.04-12.67 11.45-12.67s11.57 5.73 11.45 12.67c0 6.94-5.06 12.64-11.45 12.64Zm42.24 0C78.41 65.69 73.25 60 73.25 53.05c0-6.94 5.04-12.67 11.44-12.67s11.57 5.73 11.45 12.67c0 6.94-5.04 12.64-11.45 12.64Z"/></svg>
  <span class="dc-user">Umingle</span>
  <span class="dc-sub">Report bugs & questions on Discord</span>
</a>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê LANDING PAGE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page active" id="pageLanding">
  <nav>
    <div class="logo"><div class="logo-icon">üí¨</div>MingleNow</div>
    <div style="display:flex;align-items:center;gap:10px">
      <div class="online-badge"><span class="online-dot"></span><span id="onlineCount">0</span> online</div>
      <div id="authStatusNav" style="font-size:0.75rem;padding:6px 12px;border-radius:20px;background:var(--surface-2);border:1px solid var(--border);cursor:pointer;display:none" onclick="toggleAuthMenu()"></div>
    </div>
  </nav>

  <section class="hero">
    <h1>Chat with<br>Strangers</h1>
    <p>Meet someone new in seconds. Random video or text chats ‚Äî simple, fast, and anonymous. Ready to start mingling?</p>
    <div style="display:flex;justify-content:center;gap:10px;margin-bottom:16px;flex-wrap:wrap">
      <div class="coin-display" onclick="openCoinShop()" title="Buy M Coins" style="padding:8px 16px;font-size:0.9rem;cursor:pointer"><span class="coin-icon">ü™ô</span><span id="coinBalanceLanding">0</span> M Coins</div>
      <div class="coin-display" onclick="openPerksShop()" title="Perks Shop" style="background:linear-gradient(135deg,var(--accent),#e84393);color:#fff;padding:8px 16px;font-size:0.9rem;cursor:pointer">‚ú® Perks Shop</div>
      <div class="coin-display" onclick="openFriendsList()" title="Friends" style="background:linear-gradient(135deg,#00b894,#00cec9);color:#fff;padding:8px 16px;font-size:0.9rem;cursor:pointer">üë• Friends</div>
    </div>
    <div class="mode-cards">
      <a class="mode-card" onclick="startChat('video')">
        <div class="mode-card-icon">üé•</div><div class="mode-card-title">Video Chat</div><div class="mode-card-sub">Face-to-face with camera & mic</div>
      </a>
      <div class="or-divider">OR</div>
      <a class="mode-card" onclick="startChat('text')">
        <div class="mode-card-icon">üí¨</div><div class="mode-card-title">Text Chat</div><div class="mode-card-sub">Type your way to a conversation</div>
      </a>
    </div>
    <div class="interests-section">
      <div class="interests-label">What do you want to talk about? (optional)</div>
      <div class="interests-input-wrap" id="interestsWrap">
        <input type="text" id="interestInput" placeholder="Add interests like 'gaming', 'music', 'anime'..." />
      </div>
    </div>
    <div class="moderation-note">üí¨ Chats are moderated. Please keep it respectful.</div>
  </section>

  <div class="features">
    <div class="feature"><div class="feature-icon">üéØ</div><div class="feature-title">Interest Matching</div><div class="feature-desc">Paired with people who share your interests</div></div>
    <div class="feature"><div class="feature-icon">üîí</div><div class="feature-title">Moderation</div><div class="feature-desc">Report & block to keep the community safe</div></div>
    <div class="feature"><div class="feature-icon">üåç</div><div class="feature-title">Global</div><div class="feature-desc">Connect with people from around the world</div></div>
    <div class="feature"><div class="feature-icon">‚ö°</div><div class="feature-title">Instant</div><div class="feature-desc">No sign-up needed. Start chatting now</div></div>
    <div class="feature"><div class="feature-icon">ü™ô</div><div class="feature-title">M Coins</div><div class="feature-desc">Sign in with Google to buy coins. Your balance stays in your account forever</div></div>
    <div class="feature"><div class="feature-icon">üë§</div><div class="feature-title">Unique Username</div><div class="feature-desc">Sign in with Google to claim a permanent username, add friends, and DM</div></div>
    <div class="feature"><div class="feature-icon">üë•</div><div class="feature-title">Friends & DMs</div><div class="feature-desc">Add people you meet as friends and message them anytime</div></div>
    <div class="feature"><div class="feature-icon">üöß</div><div class="feature-title">Under Development</div><div class="feature-desc">We're still building! You may encounter bugs ‚Äî thanks for your patience</div></div>
  </div>

  <section class="leaderboard">
    <h2>üèÜ Top Gifted Users</h2>
    <div class="lb-list" id="leaderboardList">
      <div class="lb-empty">Loading leaderboard...</div>
    </div>
  </section>

  <section class="faq">
    <h2>Frequently Asked Questions</h2>
    <div class="faq-item"><div class="faq-q" onclick="this.parentElement.classList.toggle('open')">How does interest matching work?<span class="faq-arrow">‚ñæ</span></div><div class="faq-a">Add topics you enjoy. Our system prioritizes pairing you with people who listed similar interests, increasing the chances of relevant, engaging conversations.</div></div>
    <div class="faq-item"><div class="faq-q" onclick="this.parentElement.classList.toggle('open')">How do you keep chats safe?<span class="faq-arrow">‚ñæ</span></div><div class="faq-a">We provide report and block tools in every chat. Reported users are logged and repeat offenders are blocked. Please use your own judgment in online interactions.</div></div>
    <div class="faq-item"><div class="faq-q" onclick="this.parentElement.classList.toggle('open')">Can I use this on my phone?<span class="faq-arrow">‚ñæ</span></div><div class="faq-a">Yes! MingleNow works in any modern browser on phones, tablets, and desktops ‚Äî no app required.</div></div>
    <div class="faq-item"><div class="faq-q" onclick="this.parentElement.classList.toggle('open')">Is it free?<span class="faq-arrow">‚ñæ</span></div><div class="faq-a">Completely free. No hidden fees, no account needed.</div></div>
  </section>

  <footer><div>¬© 2026 MingleNow</div><div style="margin-top:8px"><a href="#" onclick="showLegalPage('rules');return false">Rules</a><a href="#" onclick="showLegalPage('terms');return false">Terms</a><a href="#" onclick="showLegalPage('privacy');return false">Privacy</a></div></footer>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê RULES PAGE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page" id="pageRules">
  <nav>
    <div class="logo" onclick="showPage('pageLanding')" style="cursor:pointer"><div class="logo-icon">üí¨</div>MingleNow</div>
    <a href="#" onclick="showPage('pageLanding');return false" style="color:var(--accent-glow);text-decoration:none;font-weight:600;font-size:0.9rem">‚Üê Back</a>
  </nav>
  <div class="legal-content">
    <h1>Community Rules</h1>
    <p class="legal-updated">Last updated: February 2026</p>

    <p>MingleNow connects strangers for video and text conversations. To keep our community safe, respectful, and enjoyable for everyone, all users must follow these rules at all times. Violations may result in an immediate and permanent ban.</p>

    <h2>1. Be Respectful</h2>
    <p>Treat every person you connect with the way you'd want to be treated. Disagreements are fine ‚Äî harassment, insults, and cruelty are not.</p>

    <h2>2. No Nudity or Sexual Content</h2>
    <p>Exposing yourself, performing sexual acts, or displaying sexually explicit material on camera is strictly prohibited. This includes partial nudity, suggestive behavior, and sharing links to explicit content. Violators will be banned immediately.</p>

    <h2>3. No Hate Speech or Slurs</h2>
    <p>Racial slurs, homophobic language, transphobic remarks, sexist comments, religious hatred, and any other form of discriminatory speech will result in an instant ban. This includes creative misspellings, abbreviations, or coded language designed to evade our filters.</p>

    <h2>4. No Violence, Gore, or Harmful Content</h2>
    <p>Do not show, share, or describe graphic violence, gore, self-harm, animal abuse, or any disturbing content. Do not threaten violence against anyone, even as a "joke."</p>

    <h2>5. No Harassment or Bullying</h2>
    <p>Targeting, following, intimidating, or repeatedly contacting someone who doesn't want to talk to you is harassment. If someone disconnects or asks you to stop, respect that.</p>

    <h2>6. No Minors in Inappropriate Contexts</h2>
    <p>MingleNow is intended for users aged 18 and older. Any content involving minors in sexual, exploitative, or dangerous contexts will result in an immediate permanent ban and may be reported to law enforcement authorities.</p>

    <h2>7. No Spam or Advertising</h2>
    <p>Don't use MingleNow to promote products, services, websites, social media accounts, or anything commercial. Don't send repetitive messages or flood the chat.</p>

    <h2>8. No Illegal Activity</h2>
    <p>Don't use MingleNow to plan, facilitate, or engage in any illegal activity. This includes drug sales, fraud, threats, doxxing, and distribution of illegal materials.</p>

    <h2>9. No Impersonation</h2>
    <p>Don't pretend to be someone else, including public figures, law enforcement, MingleNow staff, or other users.</p>

    <h2>10. No Recording Without Consent</h2>
    <p>Do not record, screenshot, or stream your conversations without the explicit consent of the other person. Distributing recorded conversations without consent is a serious violation.</p>

    <h2>Reporting Violations</h2>
    <p>If someone violates these rules, use the üö© Report button during your chat. Reports are reviewed and repeat offenders are automatically banned. False or malicious reporting is also a violation of these rules.</p>

    <h2>Consequences</h2>
    <p>Depending on the severity of the violation:</p>
    <p>‚Ä¢ <strong>Warning</strong> ‚Äî for minor infractions like mildly inappropriate language<br>
    ‚Ä¢ <strong>Immediate ban</strong> ‚Äî for hate speech, slurs, nudity, threats, or repeated violations<br>
    ‚Ä¢ <strong>Permanent ban + law enforcement referral</strong> ‚Äî for content involving minors, credible threats, or serious illegal activity</p>
    <p>Banned users may request an unban for a $7.99 fee. Repeat offenders who are banned again after paying will not be eligible for further unbans.</p>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TERMS PAGE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page" id="pageTerms">
  <nav>
    <div class="logo" onclick="showPage('pageLanding')" style="cursor:pointer"><div class="logo-icon">üí¨</div>MingleNow</div>
    <a href="#" onclick="showPage('pageLanding');return false" style="color:var(--accent-glow);text-decoration:none;font-weight:600;font-size:0.9rem">‚Üê Back</a>
  </nav>
  <div class="legal-content">
    <h1>Terms of Service</h1>
    <p class="legal-updated">Last updated: February 2026</p>

    <p>By accessing or using MingleNow ("the Service"), you agree to be bound by these Terms of Service ("Terms"). If you do not agree with these Terms, do not use the Service.</p>

    <h2>1. Eligibility</h2>
    <p>You must be at least 18 years of age to use MingleNow. By using the Service, you represent and warrant that you are 18 or older. We do not knowingly provide the Service to anyone under 18. If we discover a user is under 18, their access will be terminated immediately.</p>

    <h2>2. Description of Service</h2>
    <p>MingleNow is a platform that connects users for random one-on-one video and text conversations with strangers. The Service is provided "as is" and "as available." We do not guarantee the availability, quality, or safety of any interaction.</p>

    <h2>3. User Conduct</h2>
    <p>You agree to comply with our Community Rules at all times. You are solely responsible for your behavior and any content you share through the Service. You agree not to use the Service for any unlawful, harmful, or prohibited purpose.</p>

    <h2>4. No Guarantee of Safety</h2>
    <p>While we employ moderation tools, automated filters, and a reporting system, we cannot monitor or control all interactions on the platform. You use MingleNow at your own risk. We strongly encourage you not to share personal information (real name, address, phone number, financial details) with strangers.</p>

    <h2>5. Privacy and Data</h2>
    <p>Our use of your data is governed by our Privacy Policy. By using the Service, you consent to the practices described in our Privacy Policy.</p>

    <h2>6. Bans and Moderation</h2>
    <p>We reserve the right to ban, suspend, or restrict any user's access at our sole discretion, with or without notice, for any reason including but not limited to violations of our Community Rules. Banned users may request an unban by paying a $7.99 fee. We reserve the right to deny unban requests for severe or repeated violations. Ban decisions are final.</p>

    <h2>7. Unban Payments</h2>
    <p>Unban payments of $7.99 are non-refundable. Payment does not guarantee future access ‚Äî if you are banned again after being unbanned, your access may be permanently revoked without the option to pay again. Payments are processed through PayPal and are subject to PayPal's terms and conditions.</p>

    <h2>8. Intellectual Property</h2>
    <p>The MingleNow name, logo, design, and code are our property. You may not copy, reproduce, or distribute any part of the Service without our written permission.</p>

    <h2>9. Third-Party Services</h2>
    <p>MingleNow uses third-party services including WebRTC (for video/audio), PayPal (for payments), and web hosting providers. We are not responsible for the availability or conduct of third-party services.</p>

    <h2>10. Disclaimer of Warranties</h2>
    <p>THE SERVICE IS PROVIDED "AS IS" WITHOUT WARRANTIES OF ANY KIND, EITHER EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE, OR NON-INFRINGEMENT. WE DO NOT WARRANT THAT THE SERVICE WILL BE UNINTERRUPTED, SECURE, OR ERROR-FREE.</p>

    <h2>11. Limitation of Liability</h2>
    <p>TO THE MAXIMUM EXTENT PERMITTED BY LAW, MINGLENOW AND ITS OPERATORS SHALL NOT BE LIABLE FOR ANY INDIRECT, INCIDENTAL, SPECIAL, CONSEQUENTIAL, OR PUNITIVE DAMAGES ARISING FROM YOUR USE OF THE SERVICE, INCLUDING BUT NOT LIMITED TO EMOTIONAL DISTRESS, LOSS OF DATA, OR INTERACTIONS WITH OTHER USERS.</p>

    <h2>12. Indemnification</h2>
    <p>You agree to indemnify and hold harmless MingleNow and its operators from any claims, damages, or expenses arising from your use of the Service or violation of these Terms.</p>

    <h2>13. Changes to Terms</h2>
    <p>We may update these Terms at any time. Continued use of the Service after changes constitutes acceptance of the updated Terms. We will indicate the date of the most recent update at the top of this page.</p>

    <h2>14. Governing Law</h2>
    <p>These Terms shall be governed by and construed in accordance with applicable law. Any disputes arising from these Terms or the Service shall be resolved through binding arbitration.</p>

    <h2>15. Contact</h2>
    <p>For questions about these Terms, please contact us through the platform or at the email address listed on our website.</p>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PRIVACY PAGE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page" id="pagePrivacy">
  <nav>
    <div class="logo" onclick="showPage('pageLanding')" style="cursor:pointer"><div class="logo-icon">üí¨</div>MingleNow</div>
    <a href="#" onclick="showPage('pageLanding');return false" style="color:var(--accent-glow);text-decoration:none;font-weight:600;font-size:0.9rem">‚Üê Back</a>
  </nav>
  <div class="legal-content">
    <h1>Privacy Policy</h1>
    <p class="legal-updated">Last updated: February 2026</p>

    <p>Your privacy matters to us. This Privacy Policy explains what information we collect, how we use it, and what choices you have.</p>

    <h2>1. Information We Collect</h2>

    <h3>Information collected automatically:</h3>
    <p>‚Ä¢ <strong>IP Address</strong> ‚Äî Used for ban enforcement, abuse prevention, and approximate geographic matching. We partially mask stored IP addresses for privacy.<br>
    ‚Ä¢ <strong>Device information</strong> ‚Äî Browser type and basic device characteristics, used to optimize the experience.<br>
    ‚Ä¢ <strong>Usage data</strong> ‚Äî Connection timestamps, session duration, and feature usage for service improvement.</p>

    <h3>Information you provide:</h3>
    <p>‚Ä¢ <strong>Chat messages</strong> ‚Äî Text messages are processed in real-time by our moderation system and are not permanently stored after your session ends.<br>
    ‚Ä¢ <strong>Interests</strong> ‚Äî Topics you add for matching purposes. These are not linked to your identity.<br>
    ‚Ä¢ <strong>Reports</strong> ‚Äî When you report a user, we log the report reason and associated session data.</p>

    <h3>Information we do NOT collect:</h3>
    <p>‚Ä¢ We do not require registration, so we don't collect names, emails, phone numbers, or social media accounts.<br>
    ‚Ä¢ We do not record, store, or have access to your video or audio streams. All video/audio is transmitted directly between users via WebRTC peer-to-peer technology and never passes through our servers.<br>
    ‚Ä¢ We do not use cookies for advertising or tracking.</p>

    <h2>2. How We Use Your Information</h2>
    <p>‚Ä¢ <strong>Matching</strong> ‚Äî To pair you with other users, optionally based on shared interests.<br>
    ‚Ä¢ <strong>Moderation</strong> ‚Äî To detect and prevent hate speech, harassment, and other rule violations through automated text filtering.<br>
    ‚Ä¢ <strong>Ban enforcement</strong> ‚Äî To prevent banned users from reconnecting using their IP address.<br>
    ‚Ä¢ <strong>Service improvement</strong> ‚Äî Aggregated, anonymous usage statistics to improve performance and features.<br>
    ‚Ä¢ <strong>Payment processing</strong> ‚Äî If you make an unban payment, PayPal processes your payment information. We do not see or store your card details.</p>

    <h2>3. Data Sharing</h2>
    <p>We do not sell, rent, or trade your personal information to third parties. We may share data only in the following cases:</p>
    <p>‚Ä¢ <strong>PayPal</strong> ‚Äî Payment information for unban transactions is processed by PayPal under their privacy policy.<br>
    ‚Ä¢ <strong>Law enforcement</strong> ‚Äî We may disclose information if required by law, or if we believe in good faith that disclosure is necessary to protect safety, prevent illegal activity, or respond to a legal request.<br>
    ‚Ä¢ <strong>Abuse prevention</strong> ‚Äî IP-based ban data may be shared with other platforms to combat serious abuse (e.g., child exploitation).</p>

    <h2>4. Data Retention</h2>
    <p>‚Ä¢ <strong>Chat messages</strong> ‚Äî Not stored after the session ends.<br>
    ‚Ä¢ <strong>IP addresses</strong> ‚Äî Stored only for banned users, partially masked, for the duration of the ban.<br>
    ‚Ä¢ <strong>Report logs</strong> ‚Äî Retained for up to 12 months for moderation review.<br>
    ‚Ä¢ <strong>Payment records</strong> ‚Äî Retained as required by law and PayPal's policies.</p>

    <h2>5. Video and Audio Privacy</h2>
    <p>MingleNow uses WebRTC technology, which establishes a direct peer-to-peer connection between users. This means your video and audio streams travel directly between you and the other person ‚Äî they do not pass through our servers and we have no ability to see, record, or access them. However, be aware that the other user could potentially record their screen. Do not share anything on camera that you would not want recorded.</p>

    <h2>6. Your Rights and Choices</h2>
    <p>‚Ä¢ You can stop using the Service at any time by simply closing the browser.<br>
    ‚Ä¢ You can disconnect from any conversation at any time.<br>
    ‚Ä¢ You can choose not to enable your camera or microphone (text-only mode).<br>
    ‚Ä¢ You can choose not to share any personal information in conversations.<br>
    ‚Ä¢ If you are in a jurisdiction with data protection laws (e.g., GDPR, CCPA), you may have additional rights regarding your data. Contact us to exercise these rights.</p>

    <h2>7. Security</h2>
    <p>We take reasonable measures to protect information from unauthorized access, including encrypted connections (HTTPS/WSS), peer-to-peer video encryption (DTLS-SRTP via WebRTC), and secure payment processing via PayPal. However, no system is perfectly secure, and we cannot guarantee absolute security.</p>

    <h2>8. Children's Privacy</h2>
    <p>MingleNow is not intended for anyone under 18 years of age. We do not knowingly collect information from minors. If you believe a minor is using the Service, please report them immediately using the in-chat report tool.</p>

    <h2>9. Changes to This Policy</h2>
    <p>We may update this Privacy Policy from time to time. We will indicate the date of the most recent update at the top of this page. Continued use of the Service after changes constitutes acceptance.</p>

    <h2>10. Contact</h2>
    <p>If you have questions or concerns about this Privacy Policy or your data, please contact us through the platform.</p>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ADMIN PANEL ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page" id="pageAdmin">
  <nav>
    <div class="logo" onclick="showPage('pageLanding')" style="cursor:pointer"><div class="logo-icon">üí¨</div>MingleNow</div>
    <span style="color:var(--red);font-weight:700;font-size:0.85rem">üîí ADMIN PANEL</span>
  </nav>

  <!-- Login Screen -->
  <div class="admin-login" id="adminLogin">
    <h2>üîê Admin Login</h2>
    <p class="admin-sub">Authorized personnel only</p>
    <input class="admin-input" type="text" id="adminUser" placeholder="Username" autocomplete="off">
    <input class="admin-input" type="password" id="adminPass" placeholder="Password" autocomplete="off">
    <button class="admin-login-btn" onclick="adminDoLogin()">Login</button>
    <div class="admin-error" id="adminError">Invalid username or password</div>
  </div>

  <!-- Dashboard (hidden until login) -->
  <div class="admin-dash" id="adminDash" style="display:none">
    <div class="admin-header">
      <h1>üìä Dashboard</h1>
      <div style="display:flex;gap:8px">
        <button class="admin-refresh" onclick="adminLoadStats()">üîÑ Refresh</button>
        <button class="admin-logout" onclick="adminLogout()">Logout</button>
      </div>
    </div>

    <div class="stat-grid" id="adminStats">
      <div class="stat-card green"><div class="stat-num" id="aOnline">-</div><div class="stat-label">Online Now</div></div>
      <div class="stat-card"><div class="stat-num" id="aWaiting">-</div><div class="stat-label">In Queue</div></div>
      <div class="stat-card"><div class="stat-num" id="aConnected">-</div><div class="stat-label">Chatting</div></div>
      <div class="stat-card red"><div class="stat-num" id="aBanned">-</div><div class="stat-label">Banned</div></div>
      <div class="stat-card"><div class="stat-num" id="aUnbans">-</div><div class="stat-label">Paid Unbans</div></div>
      <div class="stat-card green"><div class="stat-num" id="aRevenue">-</div><div class="stat-label">Revenue</div></div>
      <div class="stat-card"><div class="stat-num" id="aAccounts">-</div><div class="stat-label">Accounts</div></div>
    </div>

    <!-- Quick Actions -->
    <div class="admin-section">
      <h3>‚ö° Quick Actions</h3>
      <div class="admin-action-row">
        <input type="text" id="banIPInput" placeholder="IP address or username to ban">
        <input type="text" id="banReasonInput" placeholder="Reason (optional)">
        <button style="background:var(--red);color:#fff" onclick="adminBanIP()">üö´ Ban</button>
      </div>
      <div class="admin-action-row">
        <input type="text" id="unbanIPInput" placeholder="IP address to unban">
        <button style="background:var(--green);color:#000" onclick="adminUnbanIP()">‚úÖ Unban</button>
      </div>
      <div class="admin-action-row">
        <input type="text" id="broadcastInput" placeholder="Type a broadcast message for all users...">
        <button style="background:var(--accent);color:#fff" onclick="adminBroadcast()">üì¢ Broadcast</button>
      </div>
      <div class="admin-action-row">
        <input type="text" id="giveCoinsTarget" placeholder="Username or coinKey">
        <input type="number" id="giveCoinsAmount" placeholder="Amount" min="1" style="max-width:120px">
        <button style="background:linear-gradient(135deg,#f39c12,#f1c40f);color:#000" onclick="adminGiveCoins()">ü™ô Give Coins</button>
      </div>
    </div>

    <!-- Online Users -->
    <div class="admin-section">
      <h3>üë• Online Users <button class="admin-refresh" onclick="adminLoadStats()" style="margin-left:auto">Refresh</button></h3>
      <div id="adminUsersTable"><div class="empty-msg">Loading...</div></div>
    </div>

    <!-- Registered Accounts -->
    <div class="admin-section">
      <h3>üìã Registered Accounts <span id="aAccounts" style="font-weight:400;color:var(--text-dim)"></span></h3>
      <div id="adminAccountsTable"><div class="empty-msg">Loading...</div></div>
    </div>

    <!-- Ban Log -->
    <div class="admin-section">
      <h3>üö´ Ban History</h3>
      <div id="adminBansTable"><div class="empty-msg">Loading...</div></div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê CHAT PAGE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page page-chat" id="pageChat">
  <div class="chat-nav">
    <div class="logo" onclick="goHome()"><div class="logo-icon">üí¨</div>MingleNow</div>
    <div class="chat-status">
      <span class="status-indicator searching" id="statusDot"></span>
      <span id="statusText">Connecting...</span>
    </div>
    <div style="display:flex;align-items:center;gap:8px">
      <div class="coin-display" onclick="openCoinShop()" title="Buy M Coins"><span class="coin-icon">ü™ô</span><span id="coinBalance">0</span></div>
      <div class="coin-display" onclick="openPerksShop()" title="Perks Shop" style="background:linear-gradient(135deg,var(--accent),#e84393);color:#fff">‚ú®</div>
      <div class="online-badge" style="font-size:0.8rem;padding:6px 12px">
        <span class="online-dot"></span><span id="onlineCount2">0</span>
      </div>
    </div>
  </div>

  <div class="chat-main">
    <div class="video-area" id="videoArea">
      <div class="video-grid" id="videoGrid">
        <div class="vid-box">
          <video id="localVideo" autoplay muted playsinline></video>
          <div class="vid-label">You</div>
          <div class="vid-placeholder" id="localPlaceholder" style="display:none"><div class="vid-placeholder-icon">üì∑</div><div>Camera off</div></div>
        </div>
        <div class="vid-box">
          <video id="remoteVideo" autoplay playsinline style="display:none"></video>
          <div class="vid-label">Stranger</div>
          <div class="vid-placeholder" id="remotePlaceholder"><div class="vid-placeholder-icon">üë§</div><div id="remotePlaceholderText">Searching...</div></div>
        </div>
      </div>
      <div class="controls-bar" style="position:relative">
        <button class="ctrl-btn on" id="btnMic" onclick="toggleMic()" title="Microphone">üé§</button>
        <button class="ctrl-btn on" id="btnCam" onclick="toggleCam()" title="Camera">üì∑</button>
        <button class="ctrl-btn gift-btn" onclick="toggleGiftTray()" title="Send Gift" id="btnGift">üéÅ</button>
        <button class="ctrl-btn end" onclick="goHome()" title="Stop">‚úï</button>
        <button class="ctrl-btn next" onclick="skipNext()" title="Next">‚è≠ Next</button>
        <button class="ctrl-btn reconnect-btn" onclick="doReconnect()" title="Reconnect (50 coins)" id="btnReconnect">üîÑ Reconnect</button>
        <button class="ctrl-btn add-friend-btn" onclick="addCurrentPartner()" title="Add Friend" id="btnAddFriend">‚ûï Add</button>
        <button class="ctrl-btn" onclick="openReport()" title="Report" style="font-size:0.9rem">üö©</button>

        <!-- Gift Tray -->
        <div class="gift-tray" id="giftTray">
          <div class="gift-tray-header">
            <span>üéÅ Send a Gift</span>
            <span style="color:#f1c40f;font-size:0.8rem;font-weight:700">ü™ô <span id="giftTrayBalance">0</span></span>
          </div>
          <div class="gift-grid" id="giftGrid"></div>
          <button class="gift-tray-buy" onclick="openCoinShop()">ü™ô Get More M Coins</button>
        </div>
      </div>
    </div>

    <div class="chat-sidebar" id="chatSidebar">
      <div class="chat-sidebar-header">
        <span>Chat</span>
        <span style="font-size:0.75rem;color:var(--text-dim)" id="matchInfo"></span>
        <button class="mobile-chat-close" onclick="toggleMobileChat()">‚úï</button>
      </div>
      <div class="chat-messages-list" id="chatMessages"></div>
      <div class="chat-input-bar">
        <input type="text" id="chatInput" placeholder="Type a message..." onkeydown="if(event.key==='Enter')sendChatMessage()" />
        <button onclick="sendChatMessage()">Send</button>
      </div>
    </div>
  </div>

  <button class="mobile-chat-toggle" id="mobileChatToggle" onclick="toggleMobileChat()">üí¨<span class="chat-badge" id="chatBadge">!</span></button>
</div>

<!-- Rules Screen -->
<div class="rules-overlay" id="rulesOverlay">
  <div class="rules-box">
    <h2>‚ö†Ô∏è Before You Start</h2>
    <p class="rules-sub">Please read and agree to the rules</p>
    <div class="rules-list">
      <div class="rule-item"><span class="rule-icon">‚úÖ</span><span><strong>Be respectful.</strong> Treat everyone with kindness. Harassment, hate speech, and bullying are not tolerated.</span></div>
      <div class="rule-item"><span class="rule-icon">üö´</span><span><strong>No nudity or sexual content.</strong> Keep your clothes on. Any explicit content will result in an immediate ban.</span></div>
      <div class="rule-item"><span class="rule-icon">üîí</span><span><strong>Protect your privacy.</strong> Don't share personal info like your full name, address, phone number, or school.</span></div>
      <div class="rule-item"><span class="rule-icon">üí¨</span><span><strong>This is not a dating app.</strong> MingleNow is for meeting new people and having conversations.</span></div>
      <div class="rule-item"><span class="rule-icon">üö©</span><span><strong>Report bad behavior.</strong> If someone breaks the rules, hit the üö© report button.</span></div>
    </div>
    <label class="rules-check"><input type="checkbox" id="rulesAgree" onchange="document.getElementById('rulesStartBtn').disabled=!this.checked"> I agree to follow the rules</label>
    <button id="rulesStartBtn" disabled onclick="acceptRules()">Continue ‚Üí</button>
  </div>
</div>

<!-- Auth Modal -->
<div class="username-overlay" id="usernameOverlay">
  <div class="username-box" id="authChoiceBox">
    <h2>üëã How do you want to chat?</h2>
    <p class="usub">Sign in to save your username, add friends, and send DMs ‚Äî or jump in as a guest.</p>
    <button onclick="chooseGuest()" style="background:var(--surface-2);color:var(--text);border:1px solid var(--border);margin-bottom:10px">üï∂Ô∏è Continue as Stranger</button>
    <button onclick="chooseGoogleSignIn()" style="background:#fff;color:#333;display:flex;align-items:center;justify-content:center;gap:10px">
      <svg width="18" height="18" viewBox="0 0 48 48"><path fill="#4285F4" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"/><path fill="#34A853" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"/><path fill="#FBBC05" d="M10.53 28.59A14.5 14.5 0 019.5 24c0-1.59.28-3.13.76-4.59l-7.98-6.19A23.9 23.9 0 000 24c0 3.77.9 7.34 2.56 10.52l7.97-5.93z"/><path fill="#EA4335" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 5.93C6.51 42.62 14.62 48 24 48z"/></svg>
      Sign in with Google
    </button>
    <p style="font-size:0.65rem;color:var(--text-dim);margin-top:12px">Sign in to unlock friends, DMs, and a permanent username</p>
  </div>
  <div class="username-box" id="profileSetupBox" style="display:none">
    <h2>‚ú® Set Up Your Profile</h2>
    <p class="usub">Choose your username and tell us about you</p>
    <input type="text" id="profileUsername" placeholder="Choose a username..." maxlength="20" autocomplete="off" style="text-align:center">
    <select id="profileGender" style="width:100%;padding:12px 16px;background:var(--surface-2);border:1px solid var(--border);border-radius:12px;color:var(--text);font-family:'Outfit',sans-serif;font-size:0.9rem;margin-bottom:12px;outline:none"><option value="">Select Gender (optional)</option><option value="male">Male</option><option value="female">Female</option><option value="nonbinary">Non-binary</option><option value="other">Other</option><option value="prefer_not">Prefer not to say</option></select>
    <select id="profileCountry" style="width:100%;padding:12px 16px;background:var(--surface-2);border:1px solid var(--border);border-radius:12px;color:var(--text);font-family:'Outfit',sans-serif;font-size:0.9rem;margin-bottom:12px;outline:none"><option value="">Select Country (optional)</option><option value="US">United States</option><option value="GB">United Kingdom</option><option value="CA">Canada</option><option value="AU">Australia</option><option value="DE">Germany</option><option value="FR">France</option><option value="BR">Brazil</option><option value="IN">India</option><option value="JP">Japan</option><option value="KR">South Korea</option><option value="MX">Mexico</option><option value="ES">Spain</option><option value="IT">Italy</option><option value="PH">Philippines</option><option value="TR">Turkey</option><option value="SA">Saudi Arabia</option><option value="EG">Egypt</option><option value="NG">Nigeria</option><option value="AE">UAE</option><option value="OTHER">Other</option></select>
    <div class="uname-error" id="unameError">Error</div>
    <button onclick="completeProfile()">Save & Start Chatting ‚Üí</button>
  </div>
</div>

<!-- Report Modal -->
<div class="report-overlay" id="reportOverlay">
  <div class="report-box">
    <h3>üö© Report Stranger</h3>
    <button class="report-option" onclick="submitReport('Inappropriate behavior')">Inappropriate behavior</button>
    <button class="report-option" onclick="submitReport('Nudity / Sexual content')">Nudity / Sexual content</button>
    <button class="report-option" onclick="submitReport('Harassment / Bullying')">Harassment / Bullying</button>
    <button class="report-option" onclick="submitReport('Spam')">Spam</button>
    <button class="report-option" onclick="submitReport('Underage user')">Underage user</button>
    <button class="report-cancel" onclick="closeReport()">Cancel</button>
  </div>
</div>

<!-- Friends List Modal -->
<div class="friends-overlay" id="friendsOverlay">
  <div class="friends-panel">
    <h3>üë• Friends</h3>
    <p class="fp-sub">People you've added from chats</p>
    <div id="friendsList"><div class="friends-empty">No friends yet.<br>Click ‚ûï Add during a chat to save someone!</div></div>
    <button class="friends-close" onclick="closeFriendsList()">Close</button>
  </div>
</div>

<!-- DM Chat Modal -->
<div class="dm-overlay" id="dmOverlay">
  <div class="dm-box">
    <div class="dm-header">
      <span class="dm-header-name" id="dmPartnerName">Friend</span>
      <button class="dm-header-close" onclick="closeDM()">‚úï</button>
    </div>
    <div class="dm-messages" id="dmMessages">
      <div class="dm-bubble sys">Send a message to start the conversation!</div>
    </div>
    <div class="dm-input-bar">
      <input type="text" id="dmInput" placeholder="Type a message..." onkeydown="if(event.key==='Enter')sendDM()">
      <button onclick="sendDM()">Send</button>
    </div>
  </div>
</div>

<!-- Perks Shop Modal -->
<div class="perks-overlay" id="perksOverlay">
  <div class="perks-shop">
    <h3>‚ú® Perks Shop</h3>
    <p class="ps-sub">Spend your M Coins to customize your look! ü™ô <strong id="perksBalance">0</strong></p>

    <div class="perks-section">
      <h4>üé® Username Color</h4>
      <div class="perk-grid" id="perkColorsGrid"></div>
    </div>

    <div class="perks-section">
      <h4>üí¨ Chat Bubble Theme</h4>
      <div class="perk-grid" id="perkBubblesGrid"></div>
    </div>

    <div class="perks-section">
      <h4>‚ö° Entrance Effect</h4>
      <div class="perk-grid" id="perkEntrancesGrid"></div>
    </div>

    <div class="perks-section">
      <h4>üåç Region Filter</h4>
      <div class="perk-grid" id="perkRegionsGrid"></div>
    </div>

    <button class="perks-close" onclick="closePerksShop()">Close</button>
  </div>
</div>

<!-- Coin Shop Modal -->
<div class="coin-shop-overlay" id="coinShopOverlay">
  <div class="coin-shop">
    <h3>ü™ô M Coins Shop</h3>
    <p class="shop-sub">Buy coins to send gifts during chats!</p>
    <div class="shop-balance">Your balance: <strong id="shopBalance">0</strong> M Coins</div>
    <div id="coinPackages"></div>
    <div id="coinShopPaypal"></div>
    <button class="coin-shop-close" onclick="closeCoinShop()">Close</button>
  </div>
</div>

<!-- Ban Screen -->
<div class="ban-overlay" id="banOverlay">
  <div class="ban-box">
    <div class="ban-icon">üö´</div>
    <h2>You've Been Banned</h2>
    <div class="ban-reason" id="banReason">Violation of community guidelines</div>
    <div class="ban-message">
      Your access to MingleNow has been suspended for violating our community rules.
      This includes hate speech, nudity, harassment, or other prohibited behavior.
    </div>
    <p style="font-size:0.95rem;font-weight:700;margin-bottom:12px;color:var(--text)">Get Unbanned ‚Äî $7.99</p>
    <div id="paypal-button-container" style="min-height:50px"></div>
    <div class="unban-price">One-time payment to restore your access</div>
    <div id="paypalStatus" style="font-size:0.8rem;margin-top:10px;color:var(--text-dim)"></div>
  </div>
</div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CONFIG ‚Äî Change this to your server URL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const SIGNALING_SERVER = window.location.hostname === 'localhost'
  ? 'ws://localhost:3001'
  : 'wss://minglenow-server-production.up.railway.app';  // ‚Üê REPLACE THIS after deploying server

const SERVER_HTTP = SIGNALING_SERVER.replace('wss://', 'https://').replace('ws://', 'http://');

const ICE_SERVERS = [
  { urls: 'stun:stun.l.google.com:19302' },
  { urls: 'stun:stun1.l.google.com:19302' },
  { urls: 'stun:stun2.l.google.com:19302' },
];

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let ws = null;
let pc = null;               // RTCPeerConnection
let localStream = null;
let chatMode = 'video';       // 'video' | 'text'
let micOn = true, camOn = true;
let isConnected = false;
let myId = null;
let myUsername = '';
let partnerUsername = 'Stranger';
let interests = [];

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// INTEREST TAGS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const interestInput = document.getElementById('interestInput');
const interestsWrap = document.getElementById('interestsWrap');

interestInput.addEventListener('keydown', (e) => {
  if (e.key === 'Enter' && interestInput.value.trim()) {
    e.preventDefault();
    const val = interestInput.value.trim().toLowerCase();
    if (!interests.includes(val) && interests.length < 8) {
      interests.push(val);
      const tag = document.createElement('span');
      tag.className = 'tag';
      tag.innerHTML = `${val}<span class="tag-remove" onclick="removeInterest(this,'${val}')">√ó</span>`;
      interestsWrap.insertBefore(tag, interestInput);
    }
    interestInput.value = '';
  }
});

function removeInterest(el, val) {
  interests = interests.filter(i => i !== val);
  el.parentElement.remove();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// NAVIGATION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function showPage(id) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  window.scrollTo(0, 0);
}

function showLegalPage(type) {
  const map = { rules: 'pageRules', terms: 'pageTerms', privacy: 'pagePrivacy' };
  if (map[type]) showPage(map[type]);
}

function goHome() {
  cleanup();
  showPage('pageLanding');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// START CHAT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let myGoogleId = null;
let mySignedIn = false;
let partnerSignedIn = false;

async function startChat(mode) {
  chatMode = mode;

  // Already signed in (Google) or already chose guest
  if (myUsername) {
    proceedToChat();
    return;
  }

  // Check if we have a saved Google session
  const savedGid = localStorage.getItem('mingleGoogleId');
  if (savedGid) {
    try {
      const res = await fetch(`${SERVER_HTTP}/auth/profile?googleId=${savedGid}`);
      const data = await res.json();
      if (data.account) {
        myGoogleId = savedGid;
        myUsername = data.account.username;
        mySignedIn = true;
        proceedToChat();
        return;
      }
    } catch (e) {}
  }

  // Show auth choice
  document.getElementById('authChoiceBox').style.display = 'block';
  document.getElementById('profileSetupBox').style.display = 'none';
  document.getElementById('usernameOverlay').classList.add('active');
}

function chooseGuest() {
  myUsername = '';
  mySignedIn = false;
  myGoogleId = null;
  document.getElementById('usernameOverlay').classList.remove('active');
  proceedToChat();
}

function chooseGoogleSignIn() {
  // Use Google Identity Services
  const GOOGLE_CLIENT_ID = window.GOOGLE_CLIENT_ID || '198318589094-h80chtkilpr3f90q5lft1qjnc6le6tgr.apps.googleusercontent.com';

  if (typeof google === 'undefined' || !google.accounts) {
    alert('Google Sign-In is loading. Please try again in a moment.');
    return;
  }

  google.accounts.id.initialize({
    client_id: GOOGLE_CLIENT_ID,
    callback: handleGoogleResponse,
    auto_select: false,
  });
  google.accounts.id.prompt((notification) => {
    if (notification.isNotDisplayed() || notification.isSkippedMoment()) {
      // Fallback: use renderButton approach
      const tempDiv = document.createElement('div');
      tempDiv.id = 'g-signin-temp';
      tempDiv.style.cssText = 'position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);z-index:999;background:white;padding:20px;border-radius:12px';
      document.body.appendChild(tempDiv);
      google.accounts.id.renderButton(tempDiv, { theme:'outline', size:'large', text:'signin_with', width:300 });
    }
  });
}

function handleGoogleResponse(response) {
  // Remove temp button if exists
  document.getElementById('g-signin-temp')?.remove();

  // Decode JWT to get user info
  const payload = JSON.parse(atob(response.credential.split('.')[1]));
  window._googlePayload = payload; // store for profile setup
  const googleId = payload.sub;
  const email = payload.email;
  const name = payload.name || email.split('@')[0];

  myGoogleId = googleId;
  localStorage.setItem('mingleGoogleId', googleId);

  // Check if account already exists
  fetch(`${SERVER_HTTP}/auth/profile?googleId=${googleId}`)
    .then(r => r.json())
    .then(data => {
      if (data.account && data.account.username) {
        // Existing account ‚Äî go straight in
        myUsername = data.account.username;
        mySignedIn = true;
        updateAuthStatusUI();
        document.getElementById('usernameOverlay').classList.remove('active');
        proceedToChat();
      } else {
        // New account ‚Äî show profile setup
        document.getElementById('authChoiceBox').style.display = 'none';
        document.getElementById('profileSetupBox').style.display = 'block';
        document.getElementById('profileUsername').value = name.replace(/[^a-zA-Z0-9_]/g, '').slice(0, 20);
        document.getElementById('profileUsername').focus();
      }
    })
    .catch(() => {
      document.getElementById('authChoiceBox').style.display = 'none';
      document.getElementById('profileSetupBox').style.display = 'block';
      document.getElementById('profileUsername').value = name.replace(/[^a-zA-Z0-9_]/g, '').slice(0, 20);
    });
}

async function completeProfile() {
  const username = document.getElementById('profileUsername').value.trim();
  const gender = document.getElementById('profileGender').value;
  const country = document.getElementById('profileCountry').value;
  const errEl = document.getElementById('unameError');
  errEl.style.display = 'none';

  if (username.length < 2 || username.length > 20) {
    errEl.textContent = 'Username must be 2-20 characters';
    errEl.style.display = 'block';
    return;
  }
  if (!/^[a-zA-Z0-9_]+$/.test(username)) {
    errEl.textContent = 'Letters, numbers, and underscores only';
    errEl.style.display = 'block';
    return;
  }

  const btn = document.querySelector('#profileSetupBox button');
  btn.textContent = 'Saving...';
  btn.disabled = true;

  try {
    const res = await fetch(`${SERVER_HTTP}/auth/google`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        googleId: myGoogleId,
        email: window._googlePayload?.email || '',
        username,
        gender,
        country,
      }),
    });
    const data = await res.json();

    if (data.success) {
      myUsername = data.account.username;
      mySignedIn = true;
      localStorage.setItem('mingleGoogleId', myGoogleId);
      updateAuthStatusUI();
      document.getElementById('usernameOverlay').classList.remove('active');
      proceedToChat();
    } else {
      errEl.textContent = data.error || 'Username is already taken. Try another!';
      errEl.style.display = 'block';
    }
  } catch (e) {
    errEl.textContent = 'Could not connect to server. Try again.';
    errEl.style.display = 'block';
  }

  btn.textContent = 'Save & Start Chatting ‚Üí';
  btn.disabled = false;
}

let rulesAccepted = sessionStorage.getItem('mingleRulesAccepted') === 'true';

async function proceedToChat() {
  // Show rules screen first (once per session)
  if (!rulesAccepted) {
    document.getElementById('rulesAgree').checked = false;
    document.getElementById('rulesStartBtn').disabled = true;
    document.getElementById('rulesOverlay').classList.add('active');
    return;
  }

  proceedToChatReal();
}

function acceptRules() {
  rulesAccepted = true;
  sessionStorage.setItem('mingleRulesAccepted', 'true');
  document.getElementById('rulesOverlay').classList.remove('active');
  proceedToChatReal();
}

async function proceedToChatReal() {
  // Get media for video mode
  if (chatMode === 'video') {
    try {
      const isMobile = window.innerWidth <= 768;
      localStream = await navigator.mediaDevices.getUserMedia({
        video: {
          width: { ideal: isMobile ? 480 : 1280 },
          height: { ideal: isMobile ? 640 : 720 },
          facingMode: 'user',
          frameRate: { ideal: isMobile ? 24 : 30 }
        },
        audio: {
          echoCancellation: true,
          noiseSuppression: true,
          autoGainControl: true
        }
      });
      document.getElementById('localVideo').srcObject = localStream;
      document.getElementById('localVideo').style.display = 'block';
      document.getElementById('localPlaceholder').style.display = 'none';
      micOn = true; camOn = true;
      updateMediaBtns();
    } catch (err) {
      alert('Camera/microphone access is required for video chat. Please allow access and try again.');
      return;
    }
  } else {
    // Text-only: hide video grid, show expanded chat
    document.getElementById('videoArea').style.display = 'none';
    document.getElementById('chatSidebar').style.flex = '1';
  }

  // Update "You" label with username
  document.querySelector('.vid-box .vid-label').textContent = myUsername;

  showPage('pageChat');
  setStatus('searching', 'Connecting to server...');
  connectWebSocket();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// WEBSOCKET
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function connectWebSocket() {
  if (ws && ws.readyState <= 1) ws.close();

  ws = new WebSocket(SIGNALING_SERVER);

  ws.onopen = () => {
    setStatus('searching', 'Looking for someone...');
    ws.send(JSON.stringify({ type: 'join_queue', interests, username: myUsername, googleId: myGoogleId }));
  };

  ws.onmessage = (event) => {
    const msg = JSON.parse(event.data);
    handleSignalingMessage(msg);
  };

  ws.onclose = () => {
    if (isConnected) {
      setStatus('disconnected', 'Disconnected');
      addSystemMessage('Connection to server lost. Click Next to reconnect.');
    }
  };

  ws.onerror = () => {
    setStatus('disconnected', 'Connection error');
    addSystemMessage('Could not connect to server. Make sure the signaling server is running.');
  };
}

function wsSend(data) {
  if (ws && ws.readyState === 1) ws.send(JSON.stringify(data));
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SIGNALING HANDLER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function handleSignalingMessage(msg) {
  switch (msg.type) {
    case 'welcome':
      myId = msg.id;
      updateOnlineCount(msg.online);
      if (msg.coins !== undefined) updateCoinDisplay(msg.coins);
      if (msg.perks) { myPerks = msg.perks; applyMyPerks(); }
      break;

    case 'online_count':
      updateOnlineCount(msg.count);
      break;

    case 'waiting':
      setStatus('searching', 'Looking for someone...');
      break;

    case 'matched':
      isConnected = true;
      partnerUsername = msg.partnerUsername || 'Stranger';
      partnerPerks = msg.partnerPerks || {};
      partnerSignedIn = msg.partnerSignedIn || false;
      setStatus('connected', `Connected to ${partnerUsername}!`);

      // Show/hide add friend button (both must be signed in)
      const addBtn = document.getElementById('btnAddFriend');
      if (addBtn) addBtn.style.display = (mySignedIn && partnerSignedIn && partnerUsername !== 'Stranger') ? '' : 'none';

      // Update stranger video label
      const strangerLabels = document.querySelectorAll('.vid-box:last-child .vid-label');
      strangerLabels.forEach(l => l.textContent = partnerUsername);

      // Apply perks
      applyPartnerPerks();
      applyMyPerks();

      // Show entrance effect if partner has one
      if (partnerPerks.entrance && partnerPerks.entrance !== 'none') {
        showEntranceEffect(partnerUsername, partnerPerks.entrance);
      }

      const sharedText = msg.sharedInterests?.length
        ? `Shared: ${msg.sharedInterests.join(', ')}`
        : '';
      document.getElementById('matchInfo').textContent = sharedText;

      if (msg.sharedInterests?.length) {
        addSystemMessage(`üéØ You both like: ${msg.sharedInterests.join(', ')}`);
      } else {
        addSystemMessage(`üéâ You're connected with ${partnerUsername}!`);
      }

      document.getElementById('remotePlaceholderText').textContent = 'Connecting video...';

      if (chatMode === 'video') {
        createPeerConnection();
        if (msg.role === 'initiator') {
          const offer = await pc.createOffer();
          await pc.setLocalDescription(offer);
          wsSend({ type: 'rtc_offer', sdp: offer.sdp });
        }
      }
      break;

    case 'rtc_offer':
      if (!pc) createPeerConnection();
      await pc.setRemoteDescription(new RTCSessionDescription({ type: 'offer', sdp: msg.sdp }));
      const answer = await pc.createAnswer();
      await pc.setLocalDescription(answer);
      wsSend({ type: 'rtc_answer', sdp: answer.sdp });
      break;

    case 'rtc_answer':
      if (pc) await pc.setRemoteDescription(new RTCSessionDescription({ type: 'answer', sdp: msg.sdp }));
      break;

    case 'rtc_ice_candidate':
      if (pc && msg.candidate) {
        try {
          await pc.addIceCandidate(new RTCIceCandidate(msg));
        } catch (e) { /* ignore */ }
      }
      break;

    case 'chat_message':
      addChatBubble('stranger', msg.text);
      notifyMobileChat();
      break;

    case 'partner_disconnected':
      isConnected = false;
      closePeerConnection();
      setStatus('disconnected', `${partnerUsername} disconnected`);
      addSystemMessage(`${partnerUsername} has disconnected.`);
      partnerUsername = 'Stranger';
      document.getElementById('remotePlaceholderText').textContent = 'Disconnected';
      document.getElementById('remoteVideo').style.display = 'none';
      document.getElementById('remotePlaceholder').style.display = 'flex';
      break;

    case 'report_confirmed':
      addSystemMessage('‚úÖ Report submitted. The stranger has been disconnected.');
      break;

    case 'gift_received':
      showGiftAnimation(msg.emoji, msg.name, 'received');
      break;

    case 'gift_sent':
      showGiftAnimation(msg.emoji, msg.name, 'sent');
      updateCoinDisplay(msg.balance);
      break;

    case 'gift_error':
      addSystemMessage(`‚ùå ${msg.message}`);
      break;

    case 'coins_updated':
      updateCoinDisplay(msg.balance);
      break;

    case 'perks_updated':
      myPerks = msg.perks || {};
      if (msg.balance !== undefined) updateCoinDisplay(msg.balance);
      applyMyPerks();
      break;

    case 'dm_incoming':
      receiveDM(msg.fromUsername, msg.text);
      break;

    case 'banned':
      showBanScreen(msg.reason);
      cleanup();
      break;

    case 'warning':
      showWarningToast(msg.message);
      break;

    case 'ping':
      wsSend({ type: 'pong' });
      break;
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// WEBRTC
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function createPeerConnection() {
  closePeerConnection();

  pc = new RTCPeerConnection({ iceServers: ICE_SERVERS });

  // Add local tracks
  if (localStream) {
    localStream.getTracks().forEach(track => pc.addTrack(track, localStream));
  }

  // ICE candidates
  pc.onicecandidate = (event) => {
    if (event.candidate) {
      wsSend({
        type: 'rtc_ice_candidate',
        candidate: event.candidate.candidate,
        sdpMid: event.candidate.sdpMid,
        sdpMLineIndex: event.candidate.sdpMLineIndex,
      });
    }
  };

  // Remote stream
  pc.ontrack = (event) => {
    const remoteVideo = document.getElementById('remoteVideo');
    if (event.streams && event.streams[0]) {
      remoteVideo.srcObject = event.streams[0];
    } else {
      const stream = new MediaStream();
      stream.addTrack(event.track);
      remoteVideo.srcObject = stream;
    }
    remoteVideo.style.display = 'block';
    document.getElementById('remotePlaceholder').style.display = 'none';
  };

  pc.onconnectionstatechange = () => {
    if (pc.connectionState === 'failed' || pc.connectionState === 'disconnected') {
      document.getElementById('remoteVideo').style.display = 'none';
      document.getElementById('remotePlaceholder').style.display = 'flex';
      document.getElementById('remotePlaceholderText').textContent = 'Connection lost';
    }
  };
}

function closePeerConnection() {
  if (pc) {
    pc.close();
    pc = null;
  }
  document.getElementById('remoteVideo').srcObject = null;
  document.getElementById('remoteVideo').style.display = 'none';
  document.getElementById('remotePlaceholder').style.display = 'flex';
  document.getElementById('remotePlaceholderText').textContent = 'Searching...';
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CONTROLS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function toggleMic() {
  if (!localStream) return;
  micOn = !micOn;
  localStream.getAudioTracks().forEach(t => t.enabled = micOn);
  updateMediaBtns();
}

function toggleCam() {
  if (!localStream) return;
  camOn = !camOn;
  localStream.getVideoTracks().forEach(t => t.enabled = camOn);
  document.getElementById('localVideo').style.display = camOn ? 'block' : 'none';
  document.getElementById('localPlaceholder').style.display = camOn ? 'none' : 'flex';
  updateMediaBtns();
}

function updateMediaBtns() {
  const mic = document.getElementById('btnMic');
  const cam = document.getElementById('btnCam');
  mic.textContent = micOn ? 'üé§' : 'üîá';
  mic.className = `ctrl-btn ${micOn ? 'on' : 'off'}`;
  cam.textContent = camOn ? 'üì∑' : 'üö´';
  cam.className = `ctrl-btn ${camOn ? 'on' : 'off'}`;
}

let skipPending = false;
let skipTimer = null;

function skipNext() {
  if (!isConnected) {
    // Not connected, just skip freely
    doSkip();
    return;
  }

  if (skipPending) {
    // Second press ‚Äî confirmed, do the skip
    clearTimeout(skipTimer);
    skipPending = false;
    removeSkipToast();
    doSkip();
  } else {
    // First press ‚Äî show confirmation
    skipPending = true;
    showSkipToast();
    skipTimer = setTimeout(() => {
      skipPending = false;
      removeSkipToast();
    }, 3000);
  }
}

function doSkip() {
  isConnected = false;
  partnerUsername = 'Stranger';
  closePeerConnection();
  document.getElementById('chatMessages').innerHTML = '';
  document.getElementById('matchInfo').textContent = '';
  unreadMobile = 0;
  document.getElementById('chatBadge').classList.remove('has-msg');
  setStatus('searching', 'Looking for someone...');
  wsSend({ type: 'skip', interests, username: myUsername, googleId: myGoogleId });
}

function showSkipToast() {
  removeSkipToast();
  const toast = document.createElement('div');
  toast.className = 'skip-confirm-toast';
  toast.id = 'skipToast';
  toast.textContent = 'Press Next again or Esc to skip';
  document.body.appendChild(toast);
}

function removeSkipToast() {
  document.getElementById('skipToast')?.remove();
}

// Double-Esc to skip
let escPending = false;
let escTimer = null;

document.addEventListener('keydown', (e) => {
  if (e.key === 'Escape' && document.getElementById('pageChat')?.classList.contains('active')) {
    // Close any open overlays first
    if (document.getElementById('reportOverlay')?.classList.contains('active')) return;
    if (document.getElementById('coinShopOverlay')?.classList.contains('active')) return;
    if (document.getElementById('perksOverlay')?.classList.contains('active')) return;
    if (document.getElementById('friendsOverlay')?.classList.contains('active')) return;
    if (document.getElementById('dmOverlay')?.classList.contains('active')) return;

    if (!isConnected) {
      doSkip();
      return;
    }

    if (escPending) {
      clearTimeout(escTimer);
      escPending = false;
      skipPending = false;
      removeSkipToast();
      doSkip();
    } else {
      escPending = true;
      showSkipToast();
      skipPending = true;
      escTimer = setTimeout(() => {
        escPending = false;
        skipPending = false;
        removeSkipToast();
      }, 3000);
    }
  }
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CHAT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function addChatBubble(who, text) {
  const list = document.getElementById('chatMessages');
  const div = document.createElement('div');
  div.className = `chat-bubble ${who}`;
  const label = document.createElement('div');
  label.className = 'bubble-label';
  if (who === 'you') {
    label.textContent = myUsername;
    if (myPerks.nameColor && myPerks.nameColor !== 'none') label.classList.add(`name-${myPerks.nameColor}`);
  } else {
    label.textContent = partnerUsername;
    if (partnerPerks.nameColor) label.classList.add(`name-${partnerPerks.nameColor}`);
  }
  div.appendChild(label);
  div.appendChild(document.createTextNode(text));
  list.appendChild(div);
  list.scrollTop = list.scrollHeight;
}

function addSystemMessage(text) {
  const list = document.getElementById('chatMessages');
  const div = document.createElement('div');
  div.className = 'chat-bubble system';
  div.textContent = text;
  list.appendChild(div);
  list.scrollTop = list.scrollHeight;
}

function sendChatMessage() {
  const inp = document.getElementById('chatInput');
  const text = inp.value.trim();
  if (!text || !isConnected) return;
  addChatBubble('you', text);
  wsSend({ type: 'chat_message', text });
  inp.value = '';
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// REPORT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function openReport() {
  document.getElementById('reportOverlay').classList.add('active');
}
function closeReport() {
  document.getElementById('reportOverlay').classList.remove('active');
}
function submitReport(reason) {
  wsSend({ type: 'report', reason });
  closeReport();
  isConnected = false;
  closePeerConnection();
  setStatus('disconnected', 'Reported & disconnected');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// UI HELPERS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function setStatus(state, text) {
  const dot = document.getElementById('statusDot');
  dot.className = `status-indicator ${state}`;
  document.getElementById('statusText').textContent = text;
}

function updateOnlineCount(n) {
  const str = n.toLocaleString();
  const el1 = document.getElementById('onlineCount');
  const el2 = document.getElementById('onlineCount2');
  if (el1) el1.textContent = str;
  if (el2) el2.textContent = str;
}

function toggleMobileChat() {
  const sidebar = document.getElementById('chatSidebar');
  const badge = document.getElementById('chatBadge');
  const isOpen = sidebar.classList.contains('mobile-open');

  if (isOpen) {
    sidebar.style.animation = 'slideDownChat 0.25s ease forwards';
    setTimeout(() => {
      sidebar.classList.remove('mobile-open');
      sidebar.style.animation = '';
    }, 240);
  } else {
    sidebar.classList.add('mobile-open');
    sidebar.style.animation = 'slideUpChat 0.3s ease';
    badge.classList.remove('has-msg');
    // Focus input on open
    setTimeout(() => document.getElementById('chatInput').focus(), 350);
  }
}

// Notify on mobile when chat is closed and message arrives
let unreadMobile = 0;
function notifyMobileChat() {
  const sidebar = document.getElementById('chatSidebar');
  if (window.innerWidth <= 768 && !sidebar.classList.contains('mobile-open')) {
    unreadMobile++;
    const badge = document.getElementById('chatBadge');
    badge.textContent = unreadMobile > 9 ? '9+' : unreadMobile;
    badge.classList.add('has-msg');
    // Vibrate on supported devices
    if (navigator.vibrate) navigator.vibrate(100);
  }
}

// Swipe down to close chat on mobile
(function() {
  let startY = 0, currentY = 0, dragging = false;
  const sidebar = document.getElementById('chatSidebar');

  sidebar.addEventListener('touchstart', (e) => {
    const header = sidebar.querySelector('.chat-sidebar-header');
    if (e.target === header || header.contains(e.target)) {
      startY = e.touches[0].clientY;
      dragging = true;
    }
  }, { passive: true });

  sidebar.addEventListener('touchmove', (e) => {
    if (!dragging) return;
    currentY = e.touches[0].clientY;
    const diff = currentY - startY;
    if (diff > 0) {
      sidebar.style.transform = `translateY(${diff}px)`;
    }
  }, { passive: true });

  sidebar.addEventListener('touchend', () => {
    if (!dragging) return;
    dragging = false;
    const diff = currentY - startY;
    if (diff > 80) {
      toggleMobileChat();
    }
    sidebar.style.transform = '';
  });
})();

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// FRIENDS SYSTEM
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let friendsList = [];
let currentDMFriend = null;

async function loadFriendsList() {
  if (!myGoogleId) { friendsList = []; return; }
  try {
    const res = await fetch(`${SERVER_HTTP}/friends/list?googleId=${myGoogleId}`);
    const data = await res.json();
    friendsList = data.friends || [];
  } catch (e) { friendsList = []; }
}

function openFriendsList() {
  if (!mySignedIn) {
    alert('Sign in with Google to use the friends feature!');
    return;
  }
  loadFriendsList().then(() => renderFriendsList());
  document.getElementById('friendsOverlay').classList.add('active');
}

function closeFriendsList() {
  document.getElementById('friendsOverlay').classList.remove('active');
}

async function renderFriendsList() {
  const el = document.getElementById('friendsList');
  if (friendsList.length === 0) {
    el.innerHTML = '<div class="friends-empty">No friends yet.<br>Click ‚ûï Add during a chat to save someone!</div>';
    return;
  }

  el.innerHTML = friendsList.map(f => {
    const countryFlags = {US:'üá∫üá∏',GB:'üá¨üáß',CA:'üá®üá¶',AU:'üá¶üá∫',DE:'üá©üá™',FR:'üá´üá∑',BR:'üáßüá∑',IN:'üáÆüá≥',JP:'üáØüáµ',KR:'üá∞üá∑',MX:'üá≤üáΩ',ES:'üá™üá∏',IT:'üáÆüáπ',PH:'üáµüá≠',TR:'üáπüá∑',SA:'üá∏üá¶',EG:'üá™üá¨',NG:'üá≥üá¨',AE:'üá¶üá™',OTHER:'üåç'};
    const flag = countryFlags[f.country] || '';
    const genderIcon = {male:'‚ôÇÔ∏è',female:'‚ôÄÔ∏è',nonbinary:'‚ößÔ∏è',other:'',prefer_not:''}[f.gender] || '';
    return `<div class="friend-item">
      <div class="friend-avatar">üë§</div>
      <div class="friend-info">
        <div class="friend-name">${escapeHtml(f.username)} ${flag} ${genderIcon}</div>
        <div class="friend-status ${f.online ? 'online' : ''}">${f.online ? 'üü¢ Online' : '‚ö´ Offline'}</div>
      </div>
      <div class="friend-actions">
        <button class="friend-action-btn msg" onclick="openDM('${escapeHtml(f.username)}')">üí¨</button>
        <button class="friend-action-btn remove" onclick="removeFriend('${escapeHtml(f.username)}')">‚úï</button>
      </div>
    </div>`;
  }).join('');
}

async function addCurrentPartner() {
  if (!mySignedIn || !myGoogleId) {
    addSystemMessage('‚ùå You need to sign in with Google to add friends.');
    return;
  }
  if (!isConnected || !partnerUsername || partnerUsername === 'Stranger') {
    addSystemMessage('‚ùå Can\'t add ‚Äî they\'re chatting as a Stranger.');
    return;
  }
  if (!partnerSignedIn) {
    addSystemMessage('‚ùå Can\'t add ‚Äî they\'re not signed in.');
    return;
  }

  try {
    const res = await fetch(`${SERVER_HTTP}/friends/add`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ googleId: myGoogleId, friendUsername: partnerUsername }),
    });
    const data = await res.json();

    if (data.success) {
      const toast = document.createElement('div');
      toast.className = 'friend-added-toast';
      toast.textContent = `‚úÖ Added ${partnerUsername} as a friend!`;
      document.body.appendChild(toast);
      setTimeout(() => toast.remove(), 3000);
      addSystemMessage(`‚úÖ You added ${partnerUsername} as a friend!`);
    } else {
      addSystemMessage(`‚ÑπÔ∏è ${data.error || 'Could not add friend.'}`);
    }
  } catch (e) {
    addSystemMessage('‚ùå Could not connect to server.');
  }
}

async function removeFriend(username) {
  if (!confirm(`Remove ${username} from friends?`)) return;
  try {
    await fetch(`${SERVER_HTTP}/friends/remove`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ googleId: myGoogleId, friendUsername: username }),
    });
    friendsList = friendsList.filter(f => f.username !== username);
    renderFriendsList();
  } catch (e) {}
}

// ‚îÄ‚îÄ‚îÄ DM Chat ‚îÄ‚îÄ‚îÄ
function openDM(username) {
  currentDMFriend = username;
  document.getElementById('dmPartnerName').textContent = username;
  document.getElementById('dmMessages').innerHTML = '<div class="dm-bubble sys">Send a message to start the conversation!</div>';
  document.getElementById('dmInput').value = '';
  document.getElementById('dmOverlay').classList.add('active');
  document.getElementById('dmInput').focus();

  // Load message history
  loadDMHistory(username);

  // Tell server we're in this DM
  if (ws && ws.readyState === 1) wsSend({ type: 'dm_open', friendUsername: username });
}

function closeDM() {
  document.getElementById('dmOverlay').classList.remove('active');
  currentDMFriend = null;
}

async function loadDMHistory(username) {
  if (!myGoogleId) return;
  try {
    const res = await fetch(`${SERVER_HTTP}/friends/messages?googleId=${myGoogleId}&friend=${encodeURIComponent(username)}`);
    const data = await res.json();
    const container = document.getElementById('dmMessages');
    if (data.messages && data.messages.length > 0) {
      container.innerHTML = data.messages.map(m =>
        `<div class="dm-bubble ${m.fromMe ? 'me' : 'them'}">${escapeHtml(m.text)}</div>`
      ).join('');
      container.scrollTop = container.scrollHeight;
    }
  } catch (e) {}
}

function sendDM() {
  const input = document.getElementById('dmInput');
  const text = input.value.trim();
  if (!text || !currentDMFriend || !myGoogleId) return;

  const container = document.getElementById('dmMessages');
  const bubble = document.createElement('div');
  bubble.className = 'dm-bubble me';
  bubble.textContent = text;
  container.appendChild(bubble);
  container.scrollTop = container.scrollHeight;
  input.value = '';

  wsSend({ type: 'dm_message', toUsername: currentDMFriend, text });
}

function receiveDM(fromUsername, text) {
  // If DM is open with this person, show it
  if (currentDMFriend === fromUsername) {
    const container = document.getElementById('dmMessages');
    const bubble = document.createElement('div');
    bubble.className = 'dm-bubble them';
    bubble.textContent = text;
    container.appendChild(bubble);
    container.scrollTop = container.scrollHeight;
  } else {
    // Show notification toast
    const toast = document.createElement('div');
    toast.className = 'friend-added-toast';
    toast.style.cursor = 'pointer';
    toast.textContent = `üí¨ ${fromUsername}: ${text.slice(0, 50)}`;
    toast.onclick = () => { toast.remove(); openDM(fromUsername); };
    document.body.appendChild(toast);
    setTimeout(() => toast.remove(), 5000);
  }
}

// Load friends on startup
loadFriendsList();

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PERKS SYSTEM
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let myPerks = {};
let partnerPerks = {};
let perksCatalog = {};

async function loadPerksCatalog() {
  try {
    const res = await fetch(`${SERVER_HTTP}/perks/catalog`);
    const data = await res.json();
    perksCatalog = data.perks || {};
  } catch (e) { console.log('Could not load perks catalog'); }
}

async function loadMyPerks() {
  try {
    const gid = localStorage.getItem('mingleGoogleId');
    const url = gid ? `${SERVER_HTTP}/perks/mine?googleId=${gid}` : `${SERVER_HTTP}/perks/mine`;
    const res = await fetch(url);
    const data = await res.json();
    myPerks = data.perks || {};
    updateCoinDisplay(data.balance);
  } catch (e) {}
}

function openPerksShop() {
  document.getElementById('perksBalance').textContent = myCoins;
  renderPerksShop();
  document.getElementById('perksOverlay').classList.add('active');
}

function closePerksShop() {
  document.getElementById('perksOverlay').classList.remove('active');
}

function renderPerksShop() {
  if (!perksCatalog.nameColors) return;

  // Name colors
  const colorsGrid = document.getElementById('perkColorsGrid');
  colorsGrid.innerHTML = Object.entries(perksCatalog.nameColors).map(([id, c]) => {
    const equipped = myPerks.nameColor === id;
    const swatchClass = id === 'rainbow' ? 'perk-color-swatch perk-color-rainbow' : 'perk-color-swatch';
    const swatchStyle = id !== 'rainbow' ? `background:${c.color}` : '';
    return `<div class="perk-item ${equipped ? 'equipped' : ''}" onclick="buyPerk('nameColor','${id}')">
      <div class="${swatchClass}" style="${swatchStyle}"></div>
      <div class="pi-name">${c.name}</div>
      ${equipped ? '<div class="pi-owned">‚úì Equipped</div>' : `<div class="pi-cost">ü™ô ${c.cost}</div>`}
    </div>`;
  }).join('') + `<div class="perk-item ${!myPerks.nameColor ? 'equipped' : ''}" onclick="buyPerk('nameColor','none')">
    <div class="pi-icon">üö´</div><div class="pi-name">Default</div>
    ${!myPerks.nameColor ? '<div class="pi-owned">‚úì Active</div>' : '<div class="pi-cost">Free</div>'}
  </div>`;

  // Bubble themes
  const bubblesGrid = document.getElementById('perkBubblesGrid');
  bubblesGrid.innerHTML = Object.entries(perksCatalog.bubbleThemes).map(([id, b]) => {
    const equipped = myPerks.bubbleTheme === id;
    const icons = { neon:'üíö', gradient:'üåà', dark:'üñ§', retro:'üì∫', royal:'üëë' };
    return `<div class="perk-item ${equipped ? 'equipped' : ''}" onclick="buyPerk('bubbleTheme','${id}')">
      <div class="pi-icon">${icons[id] || 'üí¨'}</div>
      <div class="pi-name">${b.name}</div>
      ${equipped ? '<div class="pi-owned">‚úì Equipped</div>' : `<div class="pi-cost">ü™ô ${b.cost}</div>`}
    </div>`;
  }).join('') + `<div class="perk-item ${!myPerks.bubbleTheme ? 'equipped' : ''}" onclick="buyPerk('bubbleTheme','none')">
    <div class="pi-icon">üö´</div><div class="pi-name">Default</div>
    ${!myPerks.bubbleTheme ? '<div class="pi-owned">‚úì Active</div>' : '<div class="pi-cost">Free</div>'}
  </div>`;

  // Entrances
  const entrancesGrid = document.getElementById('perkEntrancesGrid');
  entrancesGrid.innerHTML = Object.entries(perksCatalog.entrances).map(([id, e]) => {
    const equipped = myPerks.entrance === id;
    return `<div class="perk-item ${equipped ? 'equipped' : ''}" onclick="buyPerk('entrance','${id}')">
      <div class="pi-icon">${e.emoji}</div>
      <div class="pi-name">${e.name}</div>
      ${equipped ? '<div class="pi-owned">‚úì Equipped</div>' : `<div class="pi-cost">ü™ô ${e.cost}</div>`}
    </div>`;
  }).join('') + `<div class="perk-item ${!myPerks.entrance ? 'equipped' : ''}" onclick="buyPerk('entrance','none')">
    <div class="pi-icon">üö´</div><div class="pi-name">None</div>
    ${!myPerks.entrance ? '<div class="pi-owned">‚úì Active</div>' : '<div class="pi-cost">Free</div>'}
  </div>`;

  // Regions
  const regionsGrid = document.getElementById('perkRegionsGrid');
  const regionIcons = { any:'üåé', us:'üá∫üá∏', eu:'üá™üá∫', asia:'üåè', latam:'üåé', mena:'üåç' };
  regionsGrid.innerHTML = Object.entries(perksCatalog.regions).map(([id, r]) => {
    const equipped = (myPerks.region || 'any') === id;
    return `<div class="perk-item ${equipped ? 'equipped' : ''}" onclick="buyPerk('region','${id}')">
      <div class="pi-icon">${regionIcons[id] || 'üåé'}</div>
      <div class="pi-name">${r.name}</div>
      ${equipped ? '<div class="pi-owned">‚úì Active</div>' : (r.cost > 0 ? `<div class="pi-cost">ü™ô ${r.cost}</div>` : '<div class="pi-cost">Free</div>')}
    </div>`;
  }).join('');
}

async function buyPerk(type, id) {
  // Reset perk
  if (id === 'none') {
    myPerks[type] = null;
    // Tell server to clear it
    try {
      await fetch(`${SERVER_HTTP}/perks/buy`, {
        method: 'POST', headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ type, id: 'none', googleId: myGoogleId }),
      });
    } catch(e) {}
    renderPerksShop();
    applyMyPerks();
    return;
  }

  try {
    const res = await fetch(`${SERVER_HTTP}/perks/buy`, {
      method: 'POST', headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ type, id, googleId: myGoogleId }),
    });
    const data = await res.json();
    if (data.error === 'Not enough coins') {
      closePerksShop();
      openCoinShop();
      return;
    }
    if (data.success) {
      myPerks = data.perks;
      updateCoinDisplay(data.balance);
      document.getElementById('perksBalance').textContent = data.balance;
      renderPerksShop();
      applyMyPerks();
      // Show success toast
      const toast = document.createElement('div');
      toast.className = 'warning-toast';
      toast.style.background = 'linear-gradient(135deg,var(--accent),#e84393)';
      toast.style.color = '#fff';
      toast.textContent = '‚ú® Perk equipped!';
      document.body.appendChild(toast);
      setTimeout(() => toast.remove(), 2500);
    }
  } catch (e) { console.error('Buy perk error:', e); }
}

// Apply my name color on my own chat bubbles
function applyMyPerks() {
  // Name color on video label
  const myLabel = document.querySelector('.vid-box .vid-label');
  if (myLabel) {
    myLabel.className = 'vid-label';
    if (myPerks.nameColor && myPerks.nameColor !== 'none') myLabel.classList.add(`name-${myPerks.nameColor}`);
  }
}

// Apply partner's perks to their elements
function applyPartnerPerks() {
  // Partner name color on video label
  const labels = document.querySelectorAll('.vid-box:last-child .vid-label');
  labels.forEach(l => {
    l.className = 'vid-label';
    if (partnerPerks.nameColor) l.classList.add(`name-${partnerPerks.nameColor}`);
  });
  // Bubble theme on chat messages
  const chatList = document.getElementById('chatMessages');
  if (chatList) {
    chatList.className = 'chat-messages-list';
    if (partnerPerks.bubbleTheme) chatList.classList.add(`bubble-${partnerPerks.bubbleTheme}`);
  }
}

// Show entrance animation
function showEntranceEffect(username, entranceId) {
  if (!entranceId || entranceId === 'none') return;
  const entranceEmojis = { fire:'üî•', star:'‚≠ê', crown:'üëë', diamond:'üíé', rocket:'üöÄ' };
  const entranceNames = { fire:'Fire Entrance', star:'Star Entrance', crown:'VIP Entrance', diamond:'Diamond Entrance', rocket:'Rocket Entrance' };
  const emoji = entranceEmojis[entranceId] || '‚ú®';
  const el = document.createElement('div');
  el.className = `entrance-overlay entrance-${entranceId}`;
  el.innerHTML = `<div class="ent-content">
    <div class="ent-emoji">${emoji}${emoji}${emoji}</div>
    <div class="ent-text">${username} has arrived!</div>
    <div class="ent-sub">${entranceNames[entranceId] || ''}</div>
  </div>`;
  document.body.appendChild(el);
  setTimeout(() => el.remove(), 3000);
}

// Reconnect
function doReconnect() {
  if (!ws || ws.readyState !== 1) return;
  wsSend({ type: 'reconnect' });
}

// Load catalogs on startup
loadPerksCatalog();
loadMyPerks();

// Also fetch balance for landing page display
(function fetchBalance() {
  const gid = localStorage.getItem('mingleGoogleId');
  const url = gid ? `${SERVER_HTTP}/coins/balance?googleId=${gid}` : `${SERVER_HTTP}/coins/balance`;
  fetch(url).then(r => r.json()).then(d => { if (d.balance !== undefined) updateCoinDisplay(d.balance); }).catch(() => {});
})();

// Restore Google session on page load
(async function restoreSession() {
  const savedGid = localStorage.getItem('mingleGoogleId');
  if (savedGid) {
    try {
      const res = await fetch(`${SERVER_HTTP}/auth/profile?googleId=${savedGid}`);
      const data = await res.json();
      if (data.account) {
        myGoogleId = savedGid;
        myUsername = data.account.username;
        mySignedIn = true;
        updateAuthStatusUI();
      }
    } catch (e) {}
  }
})();

function updateAuthStatusUI() {
  const el = document.getElementById('authStatusNav');
  if (!el) return;
  if (mySignedIn && myUsername) {
    el.style.display = 'block';
    el.innerHTML = `üë§ ${myUsername} <span style="opacity:0.5;margin-left:2px">‚ñæ</span>`;
  } else {
    el.style.display = 'none';
  }
}

function toggleAuthMenu() {
  if (mySignedIn) {
    if (confirm(`Signed in as ${myUsername}\n\nSign out?`)) {
      signOut();
    }
  }
}

function signOut() {
  myGoogleId = null;
  myUsername = '';
  mySignedIn = false;
  localStorage.removeItem('mingleGoogleId');
  updateAuthStatusUI();
  // Show toast
  const toast = document.createElement('div');
  toast.className = 'friend-added-toast';
  toast.style.background = 'var(--surface-2)';
  toast.style.color = 'var(--text)';
  toast.textContent = 'üëã Signed out';
  document.body.appendChild(toast);
  setTimeout(() => toast.remove(), 2500);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// LEADERBOARD
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function loadLeaderboard() {
  try {
    const res = await fetch(`${SERVER_HTTP}/leaderboard`);
    const data = await res.json();
    renderLeaderboard(data.leaderboard || []);
  } catch (e) {
    document.getElementById('leaderboardList').innerHTML = '<div class="lb-empty">Could not load leaderboard</div>';
  }
}

function renderLeaderboard(entries) {
  const el = document.getElementById('leaderboardList');
  if (!entries.length) {
    el.innerHTML = '<div class="lb-empty">No gifts sent yet. Be the first to send a gift! üéÅ</div>';
    return;
  }

  const medals = ['üëë', 'ü•à', 'ü•â'];
  el.innerHTML = entries.map((e, i) => {
    const rankClass = i < 3 ? `lb-rank-${i + 1}` : 'lb-rank-other';
    const nameColorClass = e.nameColor && e.nameColor !== 'none' ? `name-${e.nameColor}` : '';
    return `<div class="lb-item">
      <div class="lb-rank ${rankClass}">${i < 3 ? medals[i] : i + 1}</div>
      <div class="lb-name ${nameColorClass}">${escapeHtml(e.username)}</div>
      <div class="lb-coins">ü™ô ${e.coinsReceived.toLocaleString()}</div>
    </div>`;
  }).join('');
}

function escapeHtml(str) {
  const div = document.createElement('div');
  div.textContent = str;
  return div.innerHTML;
}

// Load leaderboard on page load and refresh every 30 seconds
loadLeaderboard();
setInterval(loadLeaderboard, 30000);

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// M COINS & GIFT SYSTEM
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let myCoins = 0;
let giftCatalog = {};
let coinPackages = {};
let selectedPack = null;

function updateCoinDisplay(amount) {
  myCoins = amount;
  const ids = ['coinBalance', 'giftTrayBalance', 'shopBalance', 'coinBalanceLanding', 'perksBalance'];
  ids.forEach(id => { const el = document.getElementById(id); if (el) el.textContent = myCoins; });
}

// Load gift catalog from server
async function loadGiftCatalog() {
  try {
    const res = await fetch(`${SERVER_HTTP}/coins/catalog`);
    const data = await res.json();
    giftCatalog = data.gifts || {};
    coinPackages = data.packages || {};
    renderGiftGrid();
    renderCoinPackages();
  } catch (e) {
    // Fallback catalog
    giftCatalog = {
      rose: { name:'Rose', emoji:'üåπ', cost:5 }, heart: { name:'Heart', emoji:'‚ù§Ô∏è', cost:10 },
      fire: { name:'Fire', emoji:'üî•', cost:15 }, star: { name:'Star', emoji:'‚≠ê', cost:25 },
      crown: { name:'Crown', emoji:'üëë', cost:50 }, diamond: { name:'Diamond', emoji:'üíé', cost:100 },
      rocket: { name:'Rocket', emoji:'üöÄ', cost:200 }, galaxy: { name:'Galaxy', emoji:'üåå', cost:500 },
    };
    renderGiftGrid();
  }
}

function renderGiftGrid() {
  const grid = document.getElementById('giftGrid');
  if (!grid) return;
  grid.innerHTML = Object.entries(giftCatalog).map(([id, g]) =>
    `<div class="gift-item" onclick="sendGift('${id}')">
      <div class="gift-emoji">${g.emoji}</div>
      <div class="gift-name">${g.name}</div>
      <div class="gift-cost">ü™ô ${g.cost}</div>
    </div>`
  ).join('');
}

function renderCoinPackages() {
  const el = document.getElementById('coinPackages');
  if (!el) return;
  const bonuses = { pack1:'', pack2:'20% bonus', pack3:'50% bonus', pack4:'100% bonus' };
  el.innerHTML = Object.entries(coinPackages).map(([id, p]) =>
    `<div class="coin-pack" id="pack-${id}" onclick="selectPack('${id}')">
      <div><div class="pack-coins">ü™ô ${p.label}</div>${bonuses[id] ? `<div class="pack-bonus">${bonuses[id]}</div>` : ''}</div>
      <div class="pack-price">$${p.price}</div>
    </div>`
  ).join('');
}

function toggleGiftTray() {
  const tray = document.getElementById('giftTray');
  tray.classList.toggle('active');
  if (tray.classList.contains('active')) updateCoinDisplay(myCoins);
}

function sendGift(giftId) {
  const gift = giftCatalog[giftId];
  if (!gift) return;
  if (myCoins < gift.cost) {
    document.getElementById('giftTray').classList.remove('active');
    openCoinShop();
    return;
  }
  if (!isConnected) return;
  wsSend({ type: 'send_gift', giftId });
  document.getElementById('giftTray').classList.remove('active');
}

function showGiftAnimation(emoji, name, direction) {
  const el = document.createElement('div');
  el.className = 'gift-float';
  el.innerHTML = `<div class="gf-emoji">${emoji}</div><div class="gf-label">${direction === 'received' ? partnerUsername + ' sent' : 'You sent'} ${name}!</div>`;

  const vw = window.innerWidth;
  el.style.left = (Math.random() * (vw * 0.6) + vw * 0.2) + 'px';
  el.style.bottom = '140px';

  document.body.appendChild(el);
  setTimeout(() => el.remove(), 3000);

  if (direction === 'received') {
    addSystemMessage(`üéÅ ${partnerUsername} sent you a ${emoji} ${name}!`);
  } else {
    addSystemMessage(`üéÅ You sent ${partnerUsername} a ${emoji} ${name}!`);
  }
}

// Coin Shop
function openCoinShop() {
  if (!mySignedIn || !myGoogleId) {
    alert('Sign in with Google to purchase M Coins!');
    return;
  }
  document.getElementById('giftTray')?.classList.remove('active');
  updateCoinDisplay(myCoins);
  selectedPack = null;
  document.querySelectorAll('.coin-pack').forEach(p => p.classList.remove('selected-pack'));
  document.getElementById('coinShopPaypal').innerHTML = '';
  document.getElementById('coinShopOverlay').classList.add('active');
}

function closeCoinShop() {
  document.getElementById('coinShopOverlay').classList.remove('active');
  selectedPack = null;
}

function selectPack(packId) {
  selectedPack = packId;
  document.querySelectorAll('.coin-pack').forEach(p => p.classList.remove('selected-pack'));
  document.getElementById(`pack-${packId}`)?.classList.add('selected-pack');

  const container = document.getElementById('coinShopPaypal');
  container.innerHTML = '';

  if (typeof paypal !== 'undefined') {
    paypal.Buttons({
      style: { layout:'horizontal', color:'gold', shape:'rect', label:'pay', height:35, tagline:false },
      createOrder: function() {
        return fetch(`${SERVER_HTTP}/coins/create-order`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ packageId: selectedPack, googleId: myGoogleId }),
        }).then(r => r.json()).then(data => {
          if (data.error) { alert(data.error); throw new Error(data.error); }
          return data.orderId;
        });
      },
      onApprove: function(data) {
        return fetch(`${SERVER_HTTP}/coins/capture-order`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ orderId: data.orderID }),
        }).then(r => r.json()).then(result => {
          if (result.success) {
            updateCoinDisplay(result.balance);
            closeCoinShop();
            const toast = document.createElement('div');
            toast.className = 'warning-toast';
            toast.style.background = 'linear-gradient(135deg,#f39c12,#f1c40f)';
            toast.style.color = '#000';
            toast.textContent = `ü™ô Coins added! Balance: ${result.balance}`;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 4000);
          }
        });
      },
      onError: function() { alert('Payment error. Please try again.'); },
    }).render('#coinShopPaypal');
  }
}

// Load catalog on page load
loadGiftCatalog();

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ADMIN PANEL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let adminToken = null;

async function adminDoLogin() {
  const user = document.getElementById('adminUser').value.trim();
  const pass = document.getElementById('adminPass').value;
  const errEl = document.getElementById('adminError');
  errEl.style.display = 'none';

  try {
    const res = await fetch(`${SERVER_HTTP}/admin/login`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ username: user, password: pass }),
    });
    const data = await res.json();
    if (data.success) {
      adminToken = data.token;
      sessionStorage.setItem('adminToken', adminToken);
      document.getElementById('adminLogin').style.display = 'none';
      document.getElementById('adminDash').style.display = 'block';
      adminLoadStats();
      // Auto-refresh every 10 seconds
      if (!window._adminInterval) {
        window._adminInterval = setInterval(() => {
          if (document.getElementById('pageAdmin').classList.contains('active') && adminToken) {
            adminLoadStats();
          }
        }, 10000);
      }
    } else {
      errEl.style.display = 'block';
    }
  } catch (e) {
    errEl.textContent = 'Could not connect to server';
    errEl.style.display = 'block';
  }
}

function adminLogout() {
  adminToken = null;
  sessionStorage.removeItem('adminToken');
  document.getElementById('adminLogin').style.display = 'block';
  document.getElementById('adminDash').style.display = 'none';
  document.getElementById('adminUser').value = '';
  document.getElementById('adminPass').value = '';
}

async function adminFetch(endpoint, method = 'GET', body = null) {
  const opts = { method, headers: { 'Authorization': `Bearer ${adminToken}`, 'Content-Type': 'application/json' } };
  if (body) opts.body = JSON.stringify(body);
  const res = await fetch(`${SERVER_HTTP}${endpoint}`, opts);
  if (res.status === 401) { adminLogout(); return null; }
  return res.json();
}

async function adminLoadStats() {
  const stats = await adminFetch('/admin/stats');
  if (!stats) return;

  document.getElementById('aOnline').textContent = stats.online;
  document.getElementById('aWaiting').textContent = stats.waiting;
  document.getElementById('aConnected').textContent = stats.connected;
  document.getElementById('aBanned').textContent = stats.totalBans;
  document.getElementById('aUnbans').textContent = stats.totalUnbans;
  document.getElementById('aRevenue').textContent = `$${stats.revenue.toFixed(2)}`;
  document.querySelectorAll('#aAccounts').forEach(el => el.textContent = stats.totalAccounts || 0);

  // Online users table
  const usersDiv = document.getElementById('adminUsersTable');
  if (stats.onlineUsers.length === 0) {
    usersDiv.innerHTML = '<div class="empty-msg">No users online</div>';
  } else {
    usersDiv.innerHTML = `<table class="admin-table">
      <tr><th>Username</th><th>Type</th><th>Coins</th><th>Status</th><th>Actions</th></tr>
      ${stats.onlineUsers.map(u => {
        const typeLabel = u.signedIn
          ? '<span class="admin-badge paid" title="Google account">üîµ Google</span>'
          : '<span class="admin-badge online">üï∂Ô∏è Guest</span>';
        return `<tr>
        <td><strong>${u.username || 'Stranger'}</strong><br><span style="font-size:0.65rem;color:var(--text-dim)">${u.ip}</span></td>
        <td>${typeLabel}</td>
        <td style="color:#f1c40f;font-weight:700">ü™ô ${u.coins || 0}</td>
        <td>${u.hasPartner ? '<span class="admin-badge paired">Chatting</span>' : '<span class="admin-badge online">Waiting</span>'}</td>
        <td style="display:flex;gap:4px;flex-wrap:wrap">
          <button class="admin-action-btn kick" onclick="adminKick('${u.id}')">Kick</button>
          <button class="admin-action-btn ban" onclick="adminBanUser('${u.fullIP}','${u.username || u.id}')">Ban</button>
          <button class="admin-action-btn unban" onclick="adminGiveCoinsTo('${u.coinKey}','${u.username || 'user'}')">+Coins</button>
        </td>
      </tr>`;}).join('')}
    </table>`;
  }

  // Registered accounts table
  const accDiv = document.getElementById('adminAccountsTable');
  if (!stats.registeredAccounts || stats.registeredAccounts.length === 0) {
    accDiv.innerHTML = '<div class="empty-msg">No registered accounts</div>';
  } else {
    const countryFlags = {US:'üá∫üá∏',GB:'üá¨üáß',CA:'üá®üá¶',AU:'üá¶üá∫',DE:'üá©üá™',FR:'üá´üá∑',BR:'üáßüá∑',IN:'üáÆüá≥',JP:'üáØüáµ',KR:'üá∞üá∑',MX:'üá≤üáΩ',ES:'üá™üá∏',IT:'üáÆüáπ',PH:'üáµüá≠',TR:'üáπüá∑',SA:'üá∏üá¶',EG:'üá™üá¨',NG:'üá≥üá¨',AE:'üá¶üá™',OTHER:'üåç'};
    accDiv.innerHTML = `<table class="admin-table">
      <tr><th>Username</th><th>Email</th><th>Gender</th><th>Country</th><th>Coins</th><th>Actions</th></tr>
      ${stats.registeredAccounts.map(a => `<tr>
        <td><strong>${a.username}</strong></td>
        <td style="font-size:0.7rem;color:var(--text-dim)">${a.email || '-'}</td>
        <td>${a.gender || '-'}</td>
        <td>${(countryFlags[a.country] || '') + ' ' + (a.country || '-')}</td>
        <td style="color:#f1c40f;font-weight:700">ü™ô ${a.coins || 0}</td>
        <td style="display:flex;gap:4px;flex-wrap:wrap">
          <button class="admin-action-btn unban" onclick="adminGiveCoinsTo('g:${a.googleId}','${a.username}')">+Coins</button>
          <button class="admin-action-btn ban" onclick="adminBanUser('','${a.username}')">Ban</button>
        </td>
      </tr>`).join('')}
    </table>`;
  }

  // Bans table
  const bansData = await adminFetch('/admin/bans');
  const bansDiv = document.getElementById('adminBansTable');
  const allBans = [...(bansData?.bans || []), ...(bansData?.googleBans || [])];
  if (!allBans.length) {
    bansDiv.innerHTML = '<div class="empty-msg">No bans yet</div>';
  } else {
    bansDiv.innerHTML = `<table class="admin-table">
      <tr><th>Username</th><th>Type</th><th>Target</th><th>Reason</th><th>Date</th><th>Status</th><th>Actions</th></tr>
      ${allBans.map(b => {
        const isGoogle = b.type === 'google';
        const typeLabel = isGoogle ? 'üîµ Account' : 'üåê IP';
        const target = isGoogle ? b.googleId?.slice(0, 10) + '...' : b.ip;
        return `<tr>
        <td><strong>${b.username || '-'}</strong></td>
        <td style="font-size:0.7rem">${typeLabel}</td>
        <td class="ip" style="font-size:0.65rem">${target}</td>
        <td>${b.reason}</td>
        <td>${new Date(b.timestamp).toLocaleDateString()}</td>
        <td>${b.paid ? '<span class="admin-badge paid">Unbanned</span>' : '<span class="admin-badge active">Banned</span>'}</td>
        <td>${!b.paid ? `<button class="admin-action-btn unban" onclick="adminUnbanDirect('${isGoogle ? '' : b.fullIP}','${isGoogle ? b.googleId : ''}')">Unban</button>` : '-'}</td>
      </tr>`;}).join('')}
    </table>`;
  }
}

function adminBanUser(ip, username) {
  const reason = prompt(`Ban ${username}? Enter reason:`, 'Banned by admin');
  if (reason !== null) {
    const payload = { reason: reason || 'Banned by admin' };
    if (ip) payload.ip = ip;
    if (username && username !== 'Stranger') payload.username = username;
    adminFetch('/admin/ban', 'POST', payload).then(() => adminLoadStats());
  }
}

function adminGiveCoinsTo(coinKey, label) {
  const amount = prompt(`How many coins to give ${label}?`, '100');
  if (amount && parseInt(amount) > 0) {
    adminFetch('/admin/give-coins', 'POST', { coinKey, amount: parseInt(amount) }).then(res => {
      if (res?.success) alert(`Gave ${amount} coins. New balance: ${res.balance}`);
      adminLoadStats();
    });
  }
}

function adminUnbanDirect(ip, googleId) {
  const payload = {};
  if (ip) payload.ip = ip;
  if (googleId) payload.googleId = googleId;
  adminFetch('/admin/unban', 'POST', payload).then(() => adminLoadStats());
}

async function adminBanIP() {
  const input = document.getElementById('banIPInput').value.trim();
  const reason = document.getElementById('banReasonInput').value.trim();
  if (!input) return alert('Enter an IP address or username');
  await adminFetch('/admin/ban', 'POST', { ip: input, reason: reason || 'Banned by admin' });
  document.getElementById('banIPInput').value = '';
  document.getElementById('banReasonInput').value = '';
  adminLoadStats();
}

async function adminUnbanIP() {
  const ip = document.getElementById('unbanIPInput').value.trim();
  if (!ip) return alert('Enter an IP address');
  await adminFetch('/admin/unban', 'POST', { ip });
  document.getElementById('unbanIPInput').value = '';
  adminLoadStats();
}

async function adminKick(userId) {
  if (confirm('Kick this user?')) {
    await adminFetch('/admin/kick', 'POST', { userId });
    adminLoadStats();
  }
}

async function adminBroadcast() {
  const msg = document.getElementById('broadcastInput').value.trim();
  if (!msg) return alert('Enter a message');
  const res = await adminFetch('/admin/broadcast', 'POST', { message: msg });
  if (res?.success) {
    alert(`Broadcast sent to ${res.sent} users`);
    document.getElementById('broadcastInput').value = '';
  }
}

async function adminGiveCoins() {
  const target = document.getElementById('giveCoinsTarget').value.trim();
  const amount = parseInt(document.getElementById('giveCoinsAmount').value);
  if (!target) return alert('Enter a username or coinKey');
  if (!amount || amount < 1) return alert('Enter a valid coin amount');

  // Determine if it's a coinKey (starts with g:) or username
  const body = target.startsWith('g:') ? { coinKey: target, amount } : { username: target, amount };
  const res = await adminFetch('/admin/give-coins', 'POST', body);
  if (res?.success) {
    alert(`Gave ${amount} M Coins to ${target}\nNew balance: ${res.balance}`);
    document.getElementById('giveCoinsTarget').value = '';
    document.getElementById('giveCoinsAmount').value = '';
  } else {
    alert(res?.error || 'Failed to give coins. User not found.');
  }
}

// Check for #admin in URL
function checkAdminRoute() {
  if (window.location.hash === '#admin') {
    showPage('pageAdmin');
    // Restore session
    const saved = sessionStorage.getItem('adminToken');
    if (saved) {
      adminToken = saved;
      // Verify token is still valid
      fetch(`${SERVER_HTTP}/admin/verify`, { headers: { 'Authorization': `Bearer ${adminToken}` } })
        .then(r => r.json())
        .then(d => {
          if (d.valid) {
            document.getElementById('adminLogin').style.display = 'none';
            document.getElementById('adminDash').style.display = 'block';
            adminLoadStats();
            if (!window._adminInterval) {
              window._adminInterval = setInterval(() => {
                if (document.getElementById('pageAdmin').classList.contains('active') && adminToken) adminLoadStats();
              }, 10000);
            }
          } else {
            adminLogout();
          }
        }).catch(() => {});
    }
  }
}

window.addEventListener('hashchange', checkAdminRoute);

// Allow pressing Enter on login fields
document.getElementById('adminPass')?.addEventListener('keydown', (e) => {
  if (e.key === 'Enter') adminDoLogin();
});

document.getElementById('profileUsername')?.addEventListener('keydown', (e) => {
  if (e.key === 'Enter') completeProfile();
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CLEANUP
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function cleanup() {
  isConnected = false;
  closePeerConnection();
  if (localStream) {
    localStream.getTracks().forEach(t => t.stop());
    localStream = null;
  }
  document.getElementById('localVideo').srcObject = null;
  document.getElementById('remoteVideo').srcObject = null;
  if (ws) { ws.close(); ws = null; }
  document.getElementById('chatMessages').innerHTML = '';
  document.getElementById('matchInfo').textContent = '';
  unreadMobile = 0;
  document.getElementById('chatBadge').classList.remove('has-msg');
  // Reset layout
  document.getElementById('videoArea').style.display = '';
  document.getElementById('chatSidebar').style.flex = '';
  document.getElementById('chatSidebar').classList.remove('mobile-open');
}

// Handle page unload
window.addEventListener('beforeunload', cleanup);

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// BAN SCREEN
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function showBanScreen(reason) {
  document.getElementById('banReason').textContent = reason || 'Violation of community guidelines';
  document.getElementById('banOverlay').classList.add('active');
  showPage('pageLanding');

  // Render PayPal buttons
  const container = document.getElementById('paypal-button-container');
  container.innerHTML = ''; // Clear any existing buttons

  if (typeof paypal !== 'undefined') {
    paypal.Buttons({
      style: {
        layout: 'vertical',
        color: 'blue',
        shape: 'rect',
        label: 'pay',
        height: 40,
      },

      // Create order on server
      createOrder: function() {
        document.getElementById('paypalStatus').textContent = 'Creating order...';
        const gid = localStorage.getItem('mingleGoogleId') || '';
        return fetch(`${SERVER_HTTP}/create-unban-order`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ googleId: gid }),
        })
        .then(r => r.json())
        .then(data => {
          if (data.error) {
            document.getElementById('paypalStatus').textContent = data.message || data.error;
            throw new Error(data.error);
          }
          document.getElementById('paypalStatus').textContent = '';
          return data.orderId;
        });
      },

      // Capture payment after approval
      onApprove: function(data) {
        document.getElementById('paypalStatus').textContent = 'Processing payment...';
        return fetch(`${SERVER_HTTP}/capture-unban-order`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ orderId: data.orderID }),
        })
        .then(r => r.json())
        .then(result => {
          if (result.success) {
            document.getElementById('paypalStatus').innerHTML =
              '<span style="color:var(--green)">‚úÖ Payment successful! You are now unbanned. Refreshing...</span>';
            setTimeout(() => window.location.reload(), 2000);
          } else {
            document.getElementById('paypalStatus').textContent = 'Payment could not be completed. Please try again.';
          }
        });
      },

      onCancel: function() {
        document.getElementById('paypalStatus').textContent = 'Payment cancelled.';
      },

      onError: function(err) {
        console.error('PayPal error:', err);
        document.getElementById('paypalStatus').textContent = 'Payment error. Please try again.';
      },
    }).render('#paypal-button-container');
  } else {
    container.innerHTML = '<p style="color:var(--red);font-size:0.85rem">PayPal could not load. Please refresh the page.</p>';
  }
}

function hideBanScreen() {
  document.getElementById('banOverlay').classList.remove('active');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// WARNING TOAST
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function showWarningToast(message) {
  // Remove any existing toast
  const existing = document.querySelector('.warning-toast');
  if (existing) existing.remove();

  const toast = document.createElement('div');
  toast.className = 'warning-toast';
  toast.textContent = message;
  document.body.appendChild(toast);

  // Also show in chat
  addSystemMessage(message);

  setTimeout(() => toast.remove(), 5000);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CHECK BAN ON PAGE LOAD
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
(async function checkBanOnLoad() {
  const params = new URLSearchParams(window.location.search);
  if (params.get('unbanned') === 'true') {
    window.history.replaceState({}, '', window.location.pathname);
  }

  try {
    const gid = localStorage.getItem('mingleGoogleId') || '';
    const res = await fetch(`${SERVER_HTTP}/check-ban?googleId=${gid}`);
    const data = await res.json();
    if (data.banned) {
      showBanScreen(data.reason);
    }
  } catch (e) {
    console.log('Could not check ban status');
  }
})();
// Check for admin route on load
checkAdminRoute();
</script>
</body>
</html>
